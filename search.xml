<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>linux备份还原修复UEFI引导</title>
    <url>/2023/02/08/linux%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E4%BF%AE%E5%A4%8DUEFI%E5%BC%95%E5%AF%BC/</url>
    <content><![CDATA[<h2 id="强行备份还原-魔术方式"><a href="#强行备份还原-魔术方式" class="headerlink" title="强行备份还原(魔术方式)"></a>强行备份还原(魔术方式)</h2><ul>
<li>该方式常用于本机电脑下备份系统后, 需要还原引导,其中因为安装时目录使用是按照uefi方式安装的,所以只需要添加UEFI进行驱动即可</li>
</ul>
<ol>
<li>使用<code>blkid</code>查看当前分区下的uuid<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">blkid</span><br><span class="line"><span class="comment">#/dev/sda2: UUID=&quot;6d30aecc-c90b-4757-bad8-e7bcb37ba881&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;4b5f9e8b-19b2-4b43-b684-ca04b0a40925&quot;</span></span><br><span class="line"><span class="comment">#/dev/sda3: UUID=&quot;efa59adb-a43d-4e4c-a166-b9ad3658489d&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;0e519d50-cde9-493f-bda4-3e5e59793076&quot;</span></span><br><span class="line"><span class="comment">#/dev/sda1: UUID=&quot;3647-E782&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;905e3313-c764-4584-a4ad-a06c7653831b&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>修改引导分区中的<code>grup.cfg文件</code>,该文件是<code>grubx64.efi</code>所使用,语法参考grub:[<a href="https://www.gnu.org/software/grub/manual/grub/html_node/index.html]">https://www.gnu.org/software/grub/manual/grub/html_node/index.html]</a></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 从第0快硬盘中(hd0,gpt2) 搜索分区uuid为`6d30aecc-c90b-4757-bad8-e7bcb37ba881`的分区. 搜索该分区后, 将该分区信息分配到root变量中</span><br><span class="line"># 其中该分区应该为 安装系统的根目录`/`,比如作者安装ubuntu时区分了 `/`和`/home`挂载点为两个分区</span><br><span class="line">search.fs_uuid 6d30aecc-c90b-4757-bad8-e7bcb37ba881 root hd0,gpt2 </span><br><span class="line"># prefix表示grub引导目录, 存放`grubx64.efi`的为UEFI引导目录. 此处是兼容操作,由UEFI引导启动GRUB,再由GRUB引导启动linux系统</span><br><span class="line">set prefix=($root)&#x27;/boot/grub&#x27;</span><br><span class="line"># 按照系统目录中的grub.cfg进行引导内核</span><br><span class="line">configfile $prefix/grub.cfg</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>指定ESP分区中<code>EFI/ubuntu/shimx64.efi</code>文件为引导UEFI引导项</li>
</ol>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><p>资源: ..&#x2F;linux备份还原修复UEFI引导&#x2F;EFI.tar.gz</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://zhuanlan.zhihu.com/p/436456032">https://zhuanlan.zhihu.com/p/436456032</a></p>
]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>UEFI</tag>
      </tags>
  </entry>
  <entry>
    <title>查看java运行中的汇编</title>
    <url>/2022/08/16/%E6%9F%A5%E7%9C%8Bjava%E8%BF%90%E8%A1%8C%E4%B8%AD%E7%9A%84%E6%B1%87%E7%BC%96/</url>
    <content><![CDATA[<h2 id="使用命令行查看汇编"><a href="#使用命令行查看汇编" class="headerlink" title="使用命令行查看汇编"></a>使用命令行查看汇编</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">## 使用jitwatch查看汇编</span><br><span class="line"></span><br><span class="line">* 项目地址:https://github.com/AdoptOpenJDK/jitwatch</span><br><span class="line">* Mac应用下载地址:https://github.com/AdoptOpenJDK/jitwatch/releases/download/1.4.7/jitwatch-ui-1.4.7-shaded-mac.jar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>&#96;&#96;&#96;</p>
]]></content>
  </entry>
  <entry>
    <title>使用calibre去除DRM</title>
    <url>/2022/08/13/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/%E4%BD%BF%E7%94%A8calibre%E5%8E%BB%E9%99%A4DRM/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="DRM是什么"><a href="#DRM是什么" class="headerlink" title="DRM是什么"></a>DRM是什么</h3><p>下文摘抄自百度百科 <a href="https://baike.baidu.com/item/DRM/863505">https://baike.baidu.com/item/DRM/863505</a></p>
<blockquote>
<p>DRM，英文全称Digital Rights Management, 可以翻译为：数字版权管理。 数字版权管理是指数字内容，如音视频节目内容、文档、电子书籍等在生产、传播、销售、使用过程中 进行的权利保护、使用控制与管理的技术。</p>
</blockquote>
<h3 id="为什么需要去除DRM"><a href="#为什么需要去除DRM" class="headerlink" title="为什么需要去除DRM"></a>为什么需要去除DRM</h3><ul>
<li>上述中解释了<code>DRM</code>的作用, 但这个真的是对的吗？<br>例子:</li>
</ul>
<ol>
<li>现实生活, 在A书店购买的书籍, 可以借给同学看, 也可以放在跳蚤市场上专卖, 提高实体书的流通率.</li>
<li>在kindle上购买的书籍, 只能用在kindle设备上查看.不能专卖, 也不能借给其他人(从设备中导出提供给其他人)。</li>
</ol>
<p>由上述例子2中可以看到,电子书不能导出给其他人, 而限制不能导出使用到其他设备的<code>手段</code>,就是DRM</p>
<h3 id="如何去除DRM"><a href="#如何去除DRM" class="headerlink" title="如何去除DRM"></a>如何去除DRM</h3><ul>
<li>主要是借助DeDRM工具,下载地址:<a href="https://github.com/apprenticeharper/DeDRM_tools/releases">https://github.com/apprenticeharper/DeDRM_tools/releases</a></li>
<li>教程:<a href="https://bookfere.com/post/6.html">https://bookfere.com/post/6.html</a></li>
</ul>
]]></content>
      <tags>
        <tag>电子书</tag>
      </tags>
  </entry>
  <entry>
    <title>sdkman操作-使用本地包</title>
    <url>/2022/10/09/%E6%9D%82/sdkman%E6%93%8D%E4%BD%9C-%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E5%8C%85/</url>
    <content><![CDATA[<h1 id="sdkman操作-使用本地包"><a href="#sdkman操作-使用本地包" class="headerlink" title="sdkman操作-使用本地包"></a>sdkman操作-使用本地包</h1><p>背景: sdkman官方提供的包渠道存在缺失的可能,sdkman提供了一种使用本地包提交给其管理的模式</p>
<p>sdk man install version-calssname path<br>sdk man install 1.8-oracle &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_202.jdk&#x2F;Contents&#x2F;Home</p>
<p>1.8-oracle 分为1.8的版本和oracle的classname, 其中classname具有区分标签的功能</p>
]]></content>
      <tags>
        <tag>杂</tag>
      </tags>
  </entry>
  <entry>
    <title>编译neo4j</title>
    <url>/2022/10/09/%E6%9D%82/%E7%BC%96%E8%AF%91neo4j/</url>
    <content><![CDATA[<p>编译neo4j</p>
<p>注释掉 checkStyle的插件,避免被检测到当前环境的语法不支持</p>
<p>增加mvn打包参数</p>
<p><code>-Doverwrite</code>因为publicApi已经存在,使用该参数对于生成的api信息可以达到覆盖的作用</p>
<p><code>-DskipTests=true</code> 跳过测试用例的过程</p>
<p>在编译 neo4j-cypher-javacc-parser 包时, 会出现异常现象。<br>提示错误<code>illegal escape character</code>,目前解决的方式是暴力删除该文件</p>
<p>头发是柔软的, 也是坚硬</p>
<p>-server –home-dir&#x3D;&#x2F;Users&#x2F;jonah&#x2F;Downloads&#x2F;target&#x2F;neo4j-community-4.4.11-SNAPSHOT –config-dir&#x3D;&#x2F;Users&#x2F;jonah&#x2F;Downloads&#x2F;target&#x2F;neo4j-community-4.4.11-SNAPSHOT&#x2F;conf</p>
<p> Neo.ClientError.Security.Unauthorized: Unsupported authentication token, missing key <code>principal</code></p>
<p> 安装完Neo4j后 默认的初始用户名是:neo4j ，密码也是：neo4j</p>
<p> 填充完成密码后, 将会提示修改密码<br> express-wolf-rider-garbo-pizza-1164</p>
<p> org.neo4j.server.NeoBootstrapper#start<br>org.neo4j.server.NeoBootstrapper#createNeo<br>org.neo4j.graphdb.facade.DatabaseManagementServiceFactory#build<br>org.neo4j.graphdb.facade.DatabaseManagementServiceFactory#createBoltServer<br>org.neo4j.bolt.BoltServer#BoltServer<br>org.neo4j.bolt.BoltServer#init<br>网络协议初始化<br>org.neo4j.bolt.BoltServer#createExternalProtocolInitializer<br>org.neo4j.bolt.BoltServer#createLoopbackProtocolInitializer 内网<br>数据库管理服务初始化<br>org.neo4j.bolt.dbapi.BoltGraphDatabaseManagementServiceSPI 重要对外暴露 图数据库存储引擎api<br>org.neo4j.kernel.internal.GraphDatabaseAPI 图存储api</p>
<p>ddd模式, 完美的oop面向对象的写法. 一个node需要和另一个node创建关系<br>org.neo4j.graphdb.Node#createRelationshipTo<br>org.neo4j.kernel.impl.core.NodeEntity#createRelationshipTo</p>
<p>org.neo4j.server.CommunityEntryPoint 启动</p>
<p>dataId: neo4j-default</p>
<p>链接测试环境的 neo4j服务<br>[{<br>    “url”: “bolt:&#x2F;&#x2F;172.31.0.25:7687”,<br>    “username”: “neo4j”,<br>    “password”: “almond-alamo-truck-cable-prefix-5562”,<br>    “group”: “neo4j”,<br>        “enablemq”:true<br>}]</p>
<p><a href="http://gitlab.yunjiglobal.com/framework/yunji-community-relations.git">http://gitlab.yunjiglobal.com/framework/yunji-community-relations.git</a><br>主要代码 CommunityRelationsNeo4jService 类<br><a href="http://172.31.0.49:7474/browser/">http://172.31.0.49:7474/browser/</a> 线下测试正式库，<br><a href="http://172.31.0.49:7474/browser/">http://172.31.0.49:7474/browser/</a> 7474等同于7687</p>
<p>#spring.neo4j.authentication.username&#x3D;neo4j<br>#spring.neo4j.authentication.password&#x3D;almond-alamo-truck-cable-prefix-5562</p>
<p><a href="http://172.31.0.25:7687/browser/">http://172.31.0.25:7687/browser/</a> 环境未知</p>
]]></content>
  </entry>
  <entry>
    <title>cvs2svn安装以及将cvs转成git步骤</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/cvs%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/cvs2svn%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E5%B0%86cvs%E8%BD%AC%E6%88%90git%E6%AD%A5%E9%AA%A4/</url>
    <content><![CDATA[<h1 id="将cvs仓库转换成git仓库"><a href="#将cvs仓库转换成git仓库" class="headerlink" title="将cvs仓库转换成git仓库"></a>将cvs仓库转换成git仓库</h1><p>下载 cvs2svn<br>ubuntu环境下未找到现成的二进制工具,只能通过自行编译安装了<br>代码源地址 <a href="https://github.com/mhagger/cvs2svn">https://github.com/mhagger/cvs2svn</a><br>wget <a href="https://github.com/mhagger/cvs2svn/releases/download/2.5.0/cvs2svn-2.5.0.tar.gz">https://github.com/mhagger/cvs2svn/releases/download/2.5.0/cvs2svn-2.5.0.tar.gz</a></p>
<p>解压代码<br>tar -zxvf cvs2svn-2.5.0.tar.gz</p>
<p>编译前准备</p>
<ol>
<li>环境依赖, python2 ☆☆☆☆☆,<br>python3环境下不支持,官网有指出,为了编译成功确保本地环境的python指向python2<br>ln -s &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;usr&#x2F;bin&#x2F;python</li>
<li>cvs客户端<br>ubuntu环境下一般通过下载就能解决<br><code>sudo apt install cvs</code></li>
</ol>
<p>编译代码</p>
]]></content>
      <tags>
        <tag>cvs基本操作</tag>
        <tag>csv</tag>
      </tags>
  </entry>
  <entry>
    <title>将cvs仓库转换成git仓库</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/cvs%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/cvs2svn%E8%BD%AC%E6%8D%A2/</url>
    <content><![CDATA[<h1 id="将cvs仓库转换成git仓库"><a href="#将cvs仓库转换成git仓库" class="headerlink" title="将cvs仓库转换成git仓库"></a>将cvs仓库转换成git仓库</h1><p><a href="https://www.mcs.anl.gov/~jacob/cvs2svn/cvs2svn.html">https://www.mcs.anl.gov/~jacob/cvs2svn/cvs2svn.html</a></p>
<p>下载 cvs2svn<br>ubuntu环境下未找到现成的二进制工具,只能通过自行编译安装了<br>代码源地址 <a href="https://github.com/mhagger/cvs2svn">https://github.com/mhagger/cvs2svn</a><br>wget <a href="https://github.com/mhagger/cvs2svn/releases/download/2.5.0/cvs2svn-2.5.0.tar.gz">https://github.com/mhagger/cvs2svn/releases/download/2.5.0/cvs2svn-2.5.0.tar.gz</a></p>
<p>解压代码<br>tar -zxvf cvs2svn-2.5.0.tar.gz</p>
<p>编译前准备</p>
<ol>
<li>环境依赖, python2 ☆☆☆☆☆,<br>python3环境下不支持,官网有指出,为了编译成功确保本地环境的python指向python2<br>ln -s &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;usr&#x2F;bin&#x2F;python</li>
<li>cvs客户端<br>ubuntu环境下一般通过下载就能解决<br><code>sudo apt install cvs</code></li>
</ol>
<p>编译代码<br>make man<br>make check<br>sudo make install</p>
<p>编译成功后一般会在 &#x2F;usr&#x2F;local&#x2F;bin 下生成<code>cvs2git</code>,<code>cvs2svn</code>,<code>cvs2bzr</code><br><img src="/./asserts/cvs2svn%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90.png"></p>
<p>将cvs仓库导出成git仓库</p>
<ul>
<li>部分log message 或者author名称或者其他导致编码导出错误的可以参考 python2标准编码格式然后指定–encoding 就可以了,如果还是失败还可以指定 –fallback-encoding&#x3D;UTF8</li>
</ul>
<p>错误编码将终止流程的命令<br>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;cvs2git –blobfile&#x3D;.&#x2F;git-blob.dat –dumpfile&#x3D;.&#x2F;git-dump.dat –username&#x3D;cvsd  &#x2F;var&#x2F;lib&#x2F;cvsd&#x2F;spring-cvs</p>
<p>容错错误编码执行的命令</p>
<p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;cvs2git   –blobfile&#x3D;.&#x2F;git-blob.dat –dumpfile&#x3D;.&#x2F;git-dump.dat –encoding&#x3D;UTF8 –fallback-encoding&#x3D;UTF8 –username&#x3D;cvsd  &#x2F;var&#x2F;lib&#x2F;cvsd&#x2F;spring-cvs&#x2F;spring</p>
<p>将git二进制数据转换成成git仓库文件</p>
<p>准备git仓库<br>执行 git init –bare 将仓库转换成bare型,不指定–bare也是可以的<br>git fast-import –export-marks&#x3D;.&#x2F;git-marks.dat &lt; ..&#x2F;cvs2git&#x2F;git-blob.dat</p>
<p>git fast-import –import-marks&#x3D;.&#x2F;git-marks.dat &lt; ..&#x2F;cvs2git&#x2F;git-dump.dat</p>
]]></content>
      <tags>
        <tag>cvs基本操作</tag>
        <tag>csv</tag>
      </tags>
  </entry>
  <entry>
    <title>阅读spring早期源码-cvs</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/cvs%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/%E9%98%85%E8%AF%BBspring%E6%97%A9%E6%9C%9F%E6%BA%90%E7%A0%81/</url>
    <content><![CDATA[<h1 id="阅读spring早期源码-cvs"><a href="#阅读spring早期源码-cvs" class="headerlink" title="阅读spring早期源码-cvs"></a>阅读spring早期源码-cvs</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul>
<li>最近想了解spring最初的代码设计方式,遂在github找寻了一番无果后,查找到spring代码原提交在<code>sourceforge.net</code>中,并且有一些mailing list能在内做参考</li>
</ul>
<p>项目主页: <a href="https://sourceforge.net/p/springframework">https://sourceforge.net/p/springframework</a><br>仓库主页: <a href="https://sourceforge.net/p/springframework/cvs">https://sourceforge.net/p/springframework/cvs</a><br>邮件主页: <a href="https://sourceforge.net/p/springframework/mailman/">https://sourceforge.net/p/springframework/mailman/</a></p>
<ul>
<li>本文则是为了阅读spring代码而进行的步骤</li>
</ul>
<h2 id="在线阅读"><a href="#在线阅读" class="headerlink" title="在线阅读"></a>在线阅读</h2><p>spring提供了<code>cvs</code>匿名只读访问的地址<br>cvs是一种和git类似的版本管理工具</p>
<h3 id="使用IDE插件工具查看"><a href="#使用IDE插件工具查看" class="headerlink" title="使用IDE插件工具查看"></a>使用IDE插件工具查看</h3><p>cvs是较早期的开发出来的管理工具,并且该项目很久没有更新了,各大IDE的插件出现了不支持的现象<br>  截止2022-07-16,常用的idea、eclipse等新版IDE是不支持的(阅读兼容问题),<br>  所以推荐在idea2015或者是eclipse2015(mars)版本中安装cvs插件,安装插件方式和普通安装插件方式一样</p>
<p><code>pserver:anonymous@springframework.cvs.sourceforge.net:/cvsroot/springframework</code><br>使用idea或者eclipse 带入使用该地址即可访问项目目录, 选择spring-project即可</p>
<h3 id="使用命令行"><a href="#使用命令行" class="headerlink" title="使用命令行"></a>使用命令行</h3><p>cvs -z3 -d:pserver:<a href="mailto:&#x61;&#110;&#x6f;&#110;&#121;&#109;&#x6f;&#x75;&#x73;&#x40;&#97;&#46;&#x63;&#118;&#115;&#x2e;&#x73;&#111;&#117;&#114;&#99;&#101;&#102;&#111;&#114;&#x67;&#101;&#46;&#110;&#x65;&#x74;">&#x61;&#110;&#x6f;&#110;&#121;&#109;&#x6f;&#x75;&#x73;&#x40;&#97;&#46;&#x63;&#118;&#115;&#x2e;&#x73;&#111;&#117;&#114;&#99;&#101;&#102;&#111;&#114;&#x67;&#101;&#46;&#110;&#x65;&#x74;</a>:&#x2F;cvsroot&#x2F;springframework co -P Attic<br>cvs -z3 -d:pserver:<a href="mailto:&#97;&#x6e;&#x6f;&#110;&#121;&#x6d;&#x6f;&#117;&#115;&#x40;&#97;&#46;&#99;&#118;&#x73;&#46;&#115;&#x6f;&#117;&#x72;&#x63;&#101;&#102;&#x6f;&#114;&#103;&#x65;&#46;&#110;&#101;&#116;">&#97;&#x6e;&#x6f;&#110;&#121;&#x6d;&#x6f;&#117;&#115;&#x40;&#97;&#46;&#99;&#118;&#x73;&#46;&#115;&#x6f;&#117;&#x72;&#x63;&#101;&#102;&#x6f;&#114;&#103;&#x65;&#46;&#110;&#101;&#116;</a>:&#x2F;cvsroot&#x2F;springframework co -P i21<br>cvs -z3 cvs -z3 -d:pserver:<a href="mailto:&#97;&#110;&#x6f;&#110;&#x79;&#x6d;&#111;&#x75;&#115;&#64;&#97;&#x2e;&#x63;&#118;&#x73;&#46;&#x73;&#111;&#117;&#x72;&#99;&#x65;&#x66;&#x6f;&#114;&#103;&#101;&#x2e;&#x6e;&#101;&#x74;">&#97;&#110;&#x6f;&#110;&#x79;&#x6d;&#111;&#x75;&#115;&#64;&#97;&#x2e;&#x63;&#118;&#x73;&#46;&#x73;&#111;&#117;&#x72;&#99;&#x65;&#x66;&#x6f;&#114;&#103;&#101;&#x2e;&#x6e;&#101;&#x74;</a>:&#x2F;cvsroot&#x2F;springframework co -P samples<br>cvs -z3 -d:pserver:<a href="mailto:&#97;&#110;&#111;&#x6e;&#x79;&#x6d;&#x6f;&#x75;&#x73;&#x40;&#x61;&#46;&#99;&#118;&#x73;&#46;&#115;&#111;&#117;&#x72;&#99;&#101;&#102;&#x6f;&#114;&#103;&#x65;&#46;&#x6e;&#101;&#116;">&#97;&#110;&#111;&#x6e;&#x79;&#x6d;&#x6f;&#x75;&#x73;&#x40;&#x61;&#46;&#99;&#118;&#x73;&#46;&#115;&#111;&#117;&#x72;&#99;&#101;&#102;&#x6f;&#114;&#103;&#x65;&#46;&#x6e;&#101;&#116;</a>:&#x2F;cvsroot&#x2F;springframework co -P spring-beandoc<br>cvs -z3 -d:pserver:<a href="mailto:&#97;&#110;&#x6f;&#x6e;&#x79;&#x6d;&#x6f;&#117;&#115;&#x40;&#97;&#46;&#x63;&#x6d;&#111;&#117;&#x73;">&#97;&#110;&#x6f;&#x6e;&#x79;&#x6d;&#x6f;&#117;&#115;&#x40;&#97;&#46;&#x63;&#x6d;&#111;&#117;&#x73;</a>@a.cvs.sourceforge.net:&#x2F;cvsroot&#x2F;springframework co -P spring-projects</p>
<h2 id="搭建本地cvs仓库"><a href="#搭建本地cvs仓库" class="headerlink" title="搭建本地cvs仓库"></a>搭建本地cvs仓库</h2><ul>
<li>只是阅读代码使用在线阅读就可以了. 如果还想提交代码呢, 因为原始仓库只提供了只读功能,所以要不就提交申请账号,要么本地搭建项目了<ul>
<li>好彩spring-cvs主页中有提供完整的仓库镜像同步</li>
</ul>
</li>
</ul>
<p>官方提供cvs停用说明  <a href="https://sourceforge.net/blog/decommissioning-cvs-for-commits/">https://sourceforge.net/blog/decommissioning-cvs-for-commits/</a></p>
<p><a href="http://springframework.cvs.sourceforge.net/">http://springframework.cvs.sourceforge.net/</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -a a.cvs.sourceforge.net::cvsroot/springframewogframework/</span><br><span class="line">rsync -ai a.cvs.sourceforge.net::cvsroot/springframework/ /my/local/dest/dir/</span><br><span class="line">If you are a project admin for springframework, you can request that this page redirect to another repo on your project by submitting a</span><br></pre></td></tr></table></figure>

<h3 id="安装服务器版本"><a href="#安装服务器版本" class="headerlink" title="安装服务器版本"></a>安装服务器版本</h3><p>cvs 本身是支持client和server模式两种的, 为方便访问仓库使用cvsd挂载后台程序的方式进行管理</p>
<ol>
<li>安装cvsd工具<br>sudo apt install cvsd</li>
<li>将 刚刚同步的spring-cvs 复制到 &#x2F;var&#x2F;lib&#x2F;cvsd 目录中(此步骤可以省略,为了简化cvsd配置信息故放此处,如果需要放入其他目录,需要了解cvs权限和cvs用户相关知识)</li>
<li>编辑 &#x2F;etc&#x2F;cvsd&#x2F;cvsd.ini 配置文件添加 <code>Repos /spring-cvs</code></li>
<li>增加或者编辑spring-cvs中配置的访问用户(为方便访问,去除匿名成员组合密码)</li>
</ol>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改前 anoncvs_springframework 为用户分组,因为本地安装的cvsd创建的是`anoncvs_springframework`cvsd用户,所以指定单独仓库时针对仓库的访问用户指定转发的cvsd用户</span></span><br><span class="line"><span class="comment">## $1$0H$2/LSjjwDfsSA0gaDYY5Df/ 这个为访问密码因为未知所以直接去除</span></span><br><span class="line">anonymous1:$1$0H$2/LSjjwDfsSA0gaDYY5Df/:anoncvs_springframework</span><br><span class="line"><span class="comment"># 修改后</span></span><br><span class="line">anonymous::cvsd</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>去除只读权限,增加可写权限</li>
</ol>
<ul>
<li>cvs 可以配置当前仓库的<code>只读</code>和<code>可写</code>用户在<code>spring-cvs/CVSROOT/readers</code>和<code>spring-cvs/CVSROOT/writer</code>中<ul>
<li>cvs会有限判断用户是否在reader中,此文件中的为只读用户,就算此用户在<code>writer</code>文件中,也认为是只读</li>
</ul>
</li>
</ul>
<ol start="6">
<li><p>编辑<code>spring-cvs/CVSROOT/loginfo</code>文件去除<code>loginfo</code>中的同步review邮件(可选,cvs对于提交的记录会发送给,spring项目组进行review)</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改前</span></span><br><span class="line">DEFAULT /cvsroot/sitedocs/CVSROOT/cvstools/syncmail %&#123;sVv&#125; springframework-cvs@lists.sourceforge.net</span><br><span class="line"><span class="comment"># 修改后 删除或注释</span></span><br><span class="line"><span class="comment"># DEFAULT /cvsroot/sitedocs/CVSROOT/cvstools/syncmail %&#123;sVv&#125; springframework-cvs@lists.sourceforge.net</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>spring-cvs/CVSROOT/commitinfo</code> 去除提交规范(可选,cvs在提交时可以强制校验提交message是否符合要求)</p>
</li>
</ol>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改前</span></span><br><span class="line">ALL /cvsroot/sitedocs/CVSROOT/keepsake -p springframework</span><br><span class="line"><span class="comment"># 修改后 删除或者注释</span></span><br><span class="line"><span class="comment"># ALL /cvsroot/sitedocs/CVSROOT/keepsake -p springframework</span></span><br></pre></td></tr></table></figure>

<p>至此就已经可以在本地服务器上提交代码了,</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li>因本人习惯git操作,所以使用 cvs2git将cvs信息转换成git信息放入了仓库中<ul>
<li><code>cvs2git</code>是经过<code>cvs2svn项目</code>编译而来的. 这个项目会生成转换多种项目的工具<code>cvs2svn</code>,<code>cvs2git</code>等</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>cvs基本操作</tag>
        <tag>csv</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>redis淘汰策略实现</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/redis%E4%B8%93%E9%A2%98/redis%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>freeMemoryIfNeeded</p>
<p>“ Aloha Heja He 20:38:43<br>为什么倒序淘汰key “<br>用的空闲时间 idleTime 策略.</p>
<p>LRU,LFU,TTL策略 共性使用 idle空闲时间去讨论。即需要去除</p>
]]></content>
  </entry>
  <entry>
    <title>rocket存储引擎[0]-消息总结</title>
    <url>/2022/05/02/%E4%B8%93%E9%A2%98/rockemq%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/rocketmq/</url>
    <content><![CDATA[<p>rocketmq 和 kafka 选择区别？为什么推荐使用rocketmq</p>
<p>主要原因是对于 集群模式下的问题.<br>rocketmq 中是按照 主写, 从读的模式. 只要主挂了. 在选举的前, 只能读.<br>  rocketmq内部最初就是使用主从模式, 没有说是要做 leader切换的。在4.5之后启用了Dleader的方式进行commitLog的写入.该方式的写入是依靠raft模式进行的,<br>  在进行raft</p>
<p>kafka是存储于zookeeper中的.<br>  kafka使用zookeeper存储topicTable等信息
   </p>
]]></content>
      <categories>
        <category>中间件</category>
        <category>rocketmq</category>
      </categories>
      <tags>
        <tag>rocketmq</tag>
        <tag>源码精讲</tag>
        <tag>总结</tag>
      </tags>
  </entry>
  <entry>
    <title>rocket存储引擎[0]-消息总结</title>
    <url>/2022/05/02/%E4%B8%93%E9%A2%98/rockemq%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/rocket%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%5B0%5D-%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/../../assets/rocketmq/Rocketmq%E6%B6%88%E6%81%AF%E5%86%99%E5%85%A5%E5%8E%9F%E7%90%86.png"></p>
]]></content>
      <categories>
        <category>中间件</category>
        <category>rocketmq</category>
      </categories>
      <tags>
        <tag>rocketmq</tag>
        <tag>源码精讲</tag>
        <tag>总结</tag>
      </tags>
  </entry>
  <entry>
    <title>rocket存储引擎[1]-消息重放</title>
    <url>/2022/05/02/%E4%B8%93%E9%A2%98/rockemq%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/rocket%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%5B1%5D-%E6%B6%88%E6%81%AF%E9%87%8D%E6%94%BE/</url>
    <content><![CDATA[<h2 id="消息重放"><a href="#消息重放" class="headerlink" title="消息重放"></a>消息重放</h2><ul>
<li>rocketmq在完成将数据落入commitLog后,后台会存在<code>一个</code>线程将刚刚提交的数据,<code>重放</code>处理,使得完成一些<code>同步/复制</code>动作,这些动作包括但不限于<code>构建标签索引index文件</code>,<code>构建用于topic订阅的consumerQueue文件</code>等</li>
</ul>
<span id="more"></span> 

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>了解了 重放消息(复制消息) 再处理的过程, 当用户putMessage后消息进入 commitLog之后的事情。<br>利用 reput游标 对commitLog中的数据 读取.</p>
<ol>
<li>其中列出重放算法. 是单指针移动法, 重放指针步进. commitLog中的max边界指针在put时变动.</li>
<li>其中这个重放动作 是在额外的线程中处理的. 该处理线程为 <code>ReputMessageService</code>. 内部服务由一个死循环(由stop变量控制),做的,内部睡眠1毫秒。<br>&#x3D;&#x3D;&#x3D;&#x3D;&gt; 其实就是可以看做, 一个1毫秒的定时器,只不过这个定时器是穿行的. 上一个没有执行完不能执行下一个.</li>
<li>其中.默认的重放动作支持 可以查看 <code>CommitLogDispatcher</code> 找到实现类.<br>   在存储系统中支持的为<br>   (1) 用于构建consumerQueue的<code>CommitLogDispatcherBuildConsumeQueue</code><br>       &#x3D;&#x3D;&#x3D;&gt;废弃,ConsumerQueue的创建不再是放在<code>CommitLogDispatcherBuildConsumeQueue</code>中维护了 而是放在<code>store中的 findConsumerQueue</code>中维护,如果没有则创建一个新的逻辑性queue,猜测原因是 每条数据进行consumerQueue维护,使得consumerQueue的读写量较大？？？这个原因暂定</li>
</ol>
<p>   (2) 用于构建index的<code>CommitLogDispatcherBuildIndex</code><br>   在broker中额外支持的为<br>   (3) 在上层broker中实现了一个 <code>CommitLogDispatcherCalcBitMap</code>,作为扩展.该 dispatch是用于对构建消息的布隆过滤器的.</p>
<h2 id="重放数据思路"><a href="#重放数据思路" class="headerlink" title="重放数据思路"></a>重放数据思路</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="number">1.</span>  当前重放游标 reputFromOffset</span><br><span class="line">  <span class="number">2.</span>  当前commitLog 数据其实游标 commitLog.minOffset(startOffset)</span><br><span class="line">  <span class="number">3.</span>  当前commitLog 数据 commitLog.maxOffset(endOffset)</span><br><span class="line">   reput  min        max</span><br><span class="line">    ↓     ↓           ↓</span><br><span class="line">    <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span>   mappedFileQueue</span><br><span class="line"> 当发现 reput小于min时表示, 表示当前这个定时器已经经过很久才重新启动,需要修补reput指向min时,才能确保逻辑偏移量正确. 重放数据可能不再是针对该commitLog了？？？ 这个其实存疑, 因为commitLog 中的游标是一致往前递进的</span><br><span class="line"> 在按照reput获取到对应游标后, reput游标递进往前增, 前进步伐按照数据size决定</span><br><span class="line"><span class="comment">// 这里面就需要插一句了. commitLog内的数据不是按照固定长度进行的. 下一条消息的起始地址由 currentOffset+currentSize决定. 所以reput的下一个数据地址也同样由size决定</span></span><br><span class="line"> 在执行了一个mappedFile完成之后之后, 游标将移到下一个mappedFile中.</span><br><span class="line"> 上述画图中的<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> 对中间的commitLog消息展示可能不太直观,将数据放大后查看</span><br><span class="line"></span><br><span class="line">  mapped_1   |  mapped_2       |  mapped_3 |</span><br><span class="line">                        reputOffset</span><br><span class="line">             |               ↓ |           |</span><br><span class="line">          <span class="number">0</span> <span class="number">1</span>| <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> |<span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span>| <span class="number">14</span></span><br><span class="line">             |                 |           |</span><br><span class="line"></span><br><span class="line">   在这个场景下. reputOffset 的是 mapped_2中的消息数据,其中因为<span class="number">9</span>号数据是不正确的. totalSize不正确, 为了保持流程完整, 将跳过这个消息.</span><br><span class="line">   跳过的消息不在以 dispatchRequest中描述的size. 因为这个结果已经不正确了. 还是按照这个size进行偏移, 那么会影响到`<span class="number">10</span>`号数据的读取,那么就需要在内部进行偏移处理.得到下一个有效的偏移量了</span><br></pre></td></tr></table></figure>

<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><ul>
<li>org.apache.rocketmq.store.DefaultMessageStore.ReputMessageService#doReput</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doReput</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/// 当前重新放入的游标 较小. 这个是因为当前commitLog 提交的数据过期了？？？？没太理解这个</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.reputFromOffset &lt; DefaultMessageStore.<span class="built_in">this</span>.commitLog.getMinOffset()) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;The reputFromOffset=&#123;&#125; is smaller than minPyOffset=&#123;&#125;, this usually indicate that the dispatch behind too much and the commitlog has expired.&quot;</span>,</span><br><span class="line">            <span class="built_in">this</span>.reputFromOffset, DefaultMessageStore.<span class="built_in">this</span>.commitLog.getMinOffset());</span><br><span class="line">        <span class="built_in">this</span>.reputFromOffset = DefaultMessageStore.<span class="built_in">this</span>.commitLog.getMinOffset();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只要commitlog 还有数据和重放没有处理完就需要进行处理. 经最大可能(重放游标 小于commitLog中的最大游标)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">boolean</span> <span class="variable">doNext</span> <span class="operator">=</span> <span class="literal">true</span>; <span class="built_in">this</span>.isCommitLogAvailable() &amp;&amp; doNext; ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (DefaultMessageStore.<span class="built_in">this</span>.getMessageStoreConfig().isDuplicationEnable()</span><br><span class="line">            &amp;&amp; <span class="built_in">this</span>.reputFromOffset &gt;= DefaultMessageStore.<span class="built_in">this</span>.getConfirmOffset()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取offset对应的mapped文件 从mappedQueue中.</span></span><br><span class="line">        <span class="type">SelectMappedBufferResult</span> <span class="variable">result</span> <span class="operator">=</span> DefaultMessageStore.<span class="built_in">this</span>.commitLog.getData(reputFromOffset);</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 这个操作在第一次执行的时候意义比较大. 这个的说法是 最重复的游标进行起始步骤的变更.</span></span><br><span class="line">                <span class="comment">// 这样就算后续 reputFrom执行到之间因为 增加size的方式被修改了. 然后出现了问题.也能将整个commitLog重新提交.类似事物</span></span><br><span class="line">                <span class="built_in">this</span>.reputFromOffset = result.getStartOffset();</span><br><span class="line">                <span class="comment">// 读取mapped文, 至于怎么读, 以及从哪里读 需要 获得的result中的 byteBuffer确定了.</span></span><br><span class="line">                <span class="comment">// 在使用byteBuffer时. 会按照mapped中对于 commitLog的格式读取. 封装好 DispatchRequest. 这个request内. 含有这一条消息commit的size大小</span></span><br><span class="line">                <span class="comment">//   在 commitLog中 这个大小就是totalSize</span></span><br><span class="line">                <span class="comment">//   在读取commit的过程中. 可能会因为 commitLog中的数据自身是不完善的, 是错误格式的(错误包含 crc校验不通过,或者这条消息标记为空白等), 此时重放流程reput还是需要继续进行下去. 那么只能是说. 主动跳过这个数据</span></span><br><span class="line">                <span class="comment">//// 补充说明, 因为readSize和totalSize对不上的情况. 也就是不处理该消息了. 但是流程还是需要继续, 那么size还是需要跳过这个数据,那么就可能出现在 当前mapped处理完成后, 重新从mappedQueue中拿到的 offset大于reputFromOffset这个</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">readSize</span> <span class="operator">=</span> <span class="number">0</span>; readSize &lt; result.getSize() &amp;&amp; doNext; ) &#123;</span><br><span class="line">                    <span class="comment">// 将生产者提交的消息 .重新规整一下封装成 dispatch使用的 消息</span></span><br><span class="line">                    <span class="type">DispatchRequest</span> <span class="variable">dispatchRequest</span> <span class="operator">=</span></span><br><span class="line">                        DefaultMessageStore.<span class="built_in">this</span>.commitLog.checkMessageAndReturnSize(result.getByteBuffer(), <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> dispatchRequest.getBufferSize() == -<span class="number">1</span> ? dispatchRequest.getMsgSize() : dispatchRequest.getBufferSize();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (dispatchRequest.isSuccess()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// 将已经存储在commitLog中的消息重发出去.</span></span><br><span class="line">                            DefaultMessageStore.<span class="built_in">this</span>.doDispatch(dispatchRequest);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 这个是针对 主从模式附加的功能, 非重放主逻辑,等待看到主从的时候再回头看这个 TODO Jonah ON 2022-04-26 created</span></span><br><span class="line">                            <span class="keyword">if</span> (BrokerRole.SLAVE != DefaultMessageStore.<span class="built_in">this</span>.getMessageStoreConfig().getBrokerRole()</span><br><span class="line">                                    &amp;&amp; DefaultMessageStore.<span class="built_in">this</span>.brokerConfig.isLongPollingEnable()</span><br><span class="line">                                    &amp;&amp; DefaultMessageStore.<span class="built_in">this</span>.messageArrivingListener != <span class="literal">null</span>) &#123;</span><br><span class="line">                                DefaultMessageStore.<span class="built_in">this</span>.messageArrivingListener.arriving(dispatchRequest.getTopic(),</span><br><span class="line">                                    dispatchRequest.getQueueId(), dispatchRequest.getConsumeQueueOffset() + <span class="number">1</span>,</span><br><span class="line">                                    dispatchRequest.getTagsCode(), dispatchRequest.getStoreTimestamp(),</span><br><span class="line">                                    dispatchRequest.getBitMap(), dispatchRequest.getPropertiesMap());</span><br><span class="line">                                notifyMessageArrive4MultiQueue(dispatchRequest);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="built_in">this</span>.reputFromOffset += size;</span><br><span class="line">                            readSize += size;</span><br><span class="line">                            <span class="comment">// 这个是针对 主从模式附加的功能, 非重放主逻辑,等待看到主从的时候再回头看这个 TODO Jonah ON 2022-04-26 created</span></span><br><span class="line">                            <span class="keyword">if</span> (DefaultMessageStore.<span class="built_in">this</span>.getMessageStoreConfig().getBrokerRole() == BrokerRole.SLAVE) &#123;</span><br><span class="line">                                DefaultMessageStore.<span class="built_in">this</span>.storeStatsService</span><br><span class="line">                                    .getSinglePutMessageTopicTimesTotal(dispatchRequest.getTopic()).add(<span class="number">1</span>);</span><br><span class="line">                                DefaultMessageStore.<span class="built_in">this</span>.storeStatsService</span><br><span class="line">                                    .getSinglePutMessageTopicSizeTotal(dispatchRequest.getTopic())</span><br><span class="line">                                    .add(dispatchRequest.getMsgSize());</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="built_in">this</span>.reputFromOffset = DefaultMessageStore.<span class="built_in">this</span>.commitLog.rollNextFile(<span class="built_in">this</span>.reputFromOffset);</span><br><span class="line">                            readSize = result.getSize();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!dispatchRequest.isSuccess()) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            log.error(<span class="string">&quot;[BUG]read total count not equals msg total size. reputFromOffset=&#123;&#125;&quot;</span>, reputFromOffset);</span><br><span class="line">                            <span class="built_in">this</span>.reputFromOffset += size;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            doNext = <span class="literal">false</span>;</span><br><span class="line">                            <span class="comment">// If user open the dledger pattern or the broker is master node,</span></span><br><span class="line">                            <span class="comment">// it will not ignore the exception and fix the reputFromOffset variable</span></span><br><span class="line">                            <span class="keyword">if</span> (DefaultMessageStore.<span class="built_in">this</span>.getMessageStoreConfig().isEnableDLegerCommitLog() ||</span><br><span class="line">                                DefaultMessageStore.<span class="built_in">this</span>.brokerConfig.getBrokerId() == MixAll.MASTER_ID) &#123;</span><br><span class="line">                                log.error(<span class="string">&quot;[BUG]dispatch message to consume queue error, COMMITLOG OFFSET: &#123;&#125;&quot;</span>,</span><br><span class="line">                                    <span class="built_in">this</span>.reputFromOffset);</span><br><span class="line">                                <span class="built_in">this</span>.reputFromOffset += result.getSize() - readSize;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                result.release();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            doNext = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>中间件</category>
        <category>rocketmq</category>
      </categories>
      <tags>
        <tag>rocketmq</tag>
        <tag>源码精讲</tag>
      </tags>
  </entry>
  <entry>
    <title>rocket存储引擎[2]-构建consumerQueue文件</title>
    <url>/2022/05/02/%E4%B8%93%E9%A2%98/rockemq%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/rocket%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%5B2%5D-%E6%9E%84%E5%BB%BAconsumerQueue%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="构建ConsumerQueue"><a href="#构建ConsumerQueue" class="headerlink" title="构建ConsumerQueue"></a>构建ConsumerQueue</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>对consumeQueue进行增强处理. 除却consumerQueue基础 用于查找 topic 对应的消息 tag.</p>
<ul>
<li>额外维护了一份增强的数据 用于存储 tag信息,消息入库时间,bitmap过滤信息. 这些都是额外的</li>
</ul>
<span id="more"></span> 

<h3 id="构建主流程"><a href="#构建主流程" class="headerlink" title="构建主流程"></a>构建主流程</h3><p>上述了解了消息重放,而构建consumerQueue正是通过消息重放实现的.</p>
<p>了解到consumerQueue的构建流程. 主要是consumerQueueTable.在构建过程中会通过 findConsumerQueue,如果不存在 该topic的索引,则新创建一个.</p>
<p>consumerQueue中存储的是 topic下对应消息的地址,也就是这个数据使得 基于消息订阅成为了可能</p>
<p>另外,rocketmq对原始的consumerQueue进行了增强,额外存储了 入库时间,bitmap等信息.这些信息存储在 consumerQueue中 在写入consumerQueue对应的mapped中会额外写入这个信息</p>
<ul>
<li>org.apache.rocketmq.store.DefaultMessageStore.CommitLogDispatcherBuildConsumeQueue</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CommitLogDispatcherBuildConsumeQueue</span> <span class="keyword">implements</span> <span class="title class_">CommitLogDispatcher</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispatch</span><span class="params">(DispatchRequest request)</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">tranType</span> <span class="operator">=</span> MessageSysFlag.getTransactionValue(request.getSysFlag());</span><br><span class="line">            <span class="keyword">switch</span> (tranType) &#123;</span><br><span class="line">                <span class="keyword">case</span> MessageSysFlag.TRANSACTION_NOT_TYPE:</span><br><span class="line">                <span class="keyword">case</span> MessageSysFlag.TRANSACTION_COMMIT_TYPE:</span><br><span class="line">                    <span class="comment">// 构建consumerQueue,consumerQueue是按照topic为k,存储在consumeQueueTable中的.</span></span><br><span class="line">                    <span class="comment">// consumerQueue中存储的数据包含, 消息offset,消息大小,以及tagCode,目前tagCode为消息的hash?md5比较合适吧。</span></span><br><span class="line">                    <span class="comment">// 至于为什么是tagCode,而不是直接称呼为tagMd5,可能是因为在早期,tag数据是可以按照 1,2,3这样的需要,或者是 uuid这样的存储的.</span></span><br><span class="line">                    <span class="comment">// 但是为了读写方便?不逊要考虑读取的长度问题,统一使用一个定长字符串表示了, 这个定长字符串也就是之前说的 md5.</span></span><br><span class="line">                    DefaultMessageStore.<span class="built_in">this</span>.putMessagePositionInfo(request);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> MessageSysFlag.TRANSACTION_PREPARED_TYPE:</span><br><span class="line">                <span class="keyword">case</span> MessageSysFlag.TRANSACTION_ROLLBACK_TYPE:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>中间件</category>
        <category>rocketmq</category>
      </categories>
      <tags>
        <tag>rocketmq</tag>
        <tag>源码精讲</tag>
      </tags>
  </entry>
  <entry>
    <title>rocket存储引擎[3]-构建index文件</title>
    <url>/2022/05/02/%E4%B8%93%E9%A2%98/rockemq%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/rocket%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%5B3%5D-%E6%9E%84%E5%BB%BAindex%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="构建Index文件"><a href="#构建Index文件" class="headerlink" title="构建Index文件"></a>构建Index文件</h2><span id="more"></span> 

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[<span class="number">20220427</span>]-commitlog文件初探三-构建Index索引文件。</span><br><span class="line">index文件的构建依靠了前面提到的rePut重放数据的功能.</span><br><span class="line"><span class="number">1.</span> 在写入index之前需要寻找到物理地址 对应的index文件. 如果此index文件没有则创建. 确保在此部分可以正常操作。</span><br><span class="line">   附加讨论. 在获取index文件的时代码中使用到了 读写锁 readWriteLock. 并且在读写锁中使用了共享变量</span><br><span class="line">   这部分有一个问题是, ReentrantReadWriteLock 的操作是cas控制的。内部没有使用到 内存屏障.readWrite底层的sync是没有没有<span class="keyword">volatile</span>标记.或者是已经synchronize包含的.那么怎么防止指令重拍呢？ 其实方式很简单, 在方法内. 将共享变量使用 `&#123;&#125;`包起来,产生一个新的作用域. 变量的初始化在`&#123;&#125;`作用域之前. 这样就杜绝了 指令重拍优化了. 这个方式也是对变量的 mutable immutable的解释====&gt; 在c++领域中 mutable是指 关键词 和const同为修饰作用的.</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 通过index文件格式的解析.</span><br><span class="line">    <span class="comment">// 通过该index文件的结构. 可以了解到,索引文件本质上是一个hashmap.的文件存储实现模式。</span></span><br><span class="line">    <span class="comment">//    从索引槽到行内容,索引槽 对应的是 hashmap的 table索引槽,</span></span><br><span class="line">    <span class="comment">//    索引行中存储了pre_content_index的指针, 用于解决hash冲突,</span></span><br><span class="line">    <span class="comment">//    table索引槽中存储 最后一个hash的 content_index指针.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 对索引文件中的key进行设置. phyOffset为 commitLog中的地址信息. storeTime为commitLog 入库时间</span></span><br><span class="line">    <span class="comment">// 此处的重点为. 后续通过key进行计算过滤怎么处理。</span></span><br><span class="line">    <span class="comment">// 换句话说. 索引的数据结构是怎么样的。</span></span><br><span class="line">    <span class="comment">// 从 下方计算可以推测出. rocketmq 对于index文件的规则可以参考下方</span></span><br><span class="line">    <span class="comment">// |--------------header---index_header(40字节)------------------|</span></span><br><span class="line">    <span class="comment">// |--------------header---hash_slot----------------------------|</span></span><br><span class="line">    <span class="comment">// |--------------content_0-------------------------------------|</span></span><br><span class="line">    <span class="comment">// |--------------content_1-------------------------------------|</span></span><br><span class="line">    <span class="comment">// |--------------content_2-------------------------------------|</span></span><br><span class="line">    <span class="comment">// |--------------content_3-------------------------------------|</span></span><br><span class="line">    <span class="comment">// 其中头部 部分可以分为两种.</span></span><br><span class="line">    <span class="comment">//    第一种为 索引文件描述,内容固定,和索引内容基本无关. 总大小为40字节</span></span><br><span class="line">    <span class="comment">//    第二种为 索引槽 数据总大小为 单个槽大小*最大槽总数. 其中单个槽大小固定为4字节,槽总数通过messageStoreConfig 传入。</span></span><br><span class="line">    <span class="comment">//      索引槽 内容为查询key的 hash值. 所以单个槽内容为4字节.</span></span><br><span class="line">    <span class="comment">//      既然 索引槽内容为hash值, 那么可以大胆的推断出 index文件使用 hash计算得到该key的相对于槽而言的位置大小,通过槽内的内容也就可以知道.该key所对应数据的真实文件位置,解释按照下方给出</span></span><br><span class="line">    <span class="comment">// 其中除却头部部分,其他均为索引内容(索引行内容方案 ☆☆☆☆☆)</span></span><br><span class="line">    <span class="comment">//    平时通过内存中的hash,list结构很容易找出值在哪里.如果需要放在文件系统中呢？并且如果内容长度是可变的话,怎么找寻呢？</span></span><br><span class="line">    <span class="comment">//    如果需要考虑可变内容,那么还需要在额外存放行内容大小,如果是按照list顺序遍历的方式,这样是没问题的. 但是这样就导致每次查询都从0还是,查询效率就非常的慢了,</span></span><br><span class="line">    <span class="comment">//       当然也可以做二分查找,但是总共需要跳过的字节数还是需要计算出来</span></span><br><span class="line">    <span class="comment">////       |content0_index|content0_size|content0_data|  40 字节 0~40</span></span><br><span class="line">    <span class="comment">///        |content1_index|content1_size|content1_data|  60 字节 40~100</span></span><br><span class="line">    <span class="comment">///        |content2_index|content2_size|content2_data|  80 字节 100~180</span></span><br><span class="line">    <span class="comment">///        查找一个数据需要通过 0开始遍历对size进行累加才能计算出 需要跳过的数据  比如需要查找content_2的数据,需要对content_0和content_1的数据进行累加 =100,这个数据为跳过数据</span></span><br><span class="line">    <span class="comment">//    那么就可以考虑规避这个问题,使用固定长度的`内容行` 此时就有计算规则了. 文件行的内容起始位置=文件头部(包含索引槽和索引文件描述)+偏移地址*内容长度</span></span><br><span class="line">    <span class="comment">//         |content0_index|content0_data|  40 字节 0~40</span></span><br><span class="line">    <span class="comment">//         |content1_index|content1_data|  40 字节 40~80</span></span><br><span class="line">    <span class="comment">//         |content2_index|content2_data|  40 字节 80~120</span></span><br><span class="line">    <span class="comment">//         |content3_index|content3_data|  40 字节 120~160</span></span><br><span class="line">    <span class="comment">//       通过固定长度的内容行. 可以很便捷计算出需要跳过的数据  同样按照查找 content_2为例. 需要跳过的数据 2 * 40 = 80 并不需要针对每个进行累加</span></span><br><span class="line">    <span class="comment">// 上述方案概要完成, 可以细则解释</span></span><br><span class="line">    <span class="comment">// Q1 文件头部存放了什么?</span></span><br><span class="line">    <span class="comment">// A1 index_header 主要存放是的整体索引文件 元数据信息。</span></span><br><span class="line">    <span class="comment">//   其中包含</span></span><br><span class="line">    <span class="comment">//   1. beginTimestampIndex 第一个写入消息时创建索引文件创建时间戳. 使用的是 long 占用 8字节</span></span><br><span class="line">    <span class="comment">//   2. endTimestampIndex 索引文件最后写入的时间戳, 使用的是 long 占用8字节</span></span><br><span class="line">    <span class="comment">//   3. beginPhyoffsetIndex 第一个写入消息的物理地址  使用的是 long 占用8字节</span></span><br><span class="line">    <span class="comment">//   4. endPhyoffsetIndex 最后一个写入消息的物理地址  使用的是 long 占用8字节</span></span><br><span class="line">    <span class="comment">//   5. hashSlotcountIndex 索引槽的总数 已经使用的索引槽. 配置文件内有固定的索引槽. 但是对于文件内真实存在的就需要文件自己记录,用于后续使用 使用的是int 占用4字节</span></span><br><span class="line">    <span class="comment">//   6. indexCountIndex 索引内容的总数 已经使用的索引内容. 该数据一般和`hashSlotcountIndex` 是一样的。   使用的是int 占用4字节</span></span><br><span class="line">    <span class="comment">// Q2 索引槽中到底存放了什么?</span></span><br><span class="line">    <span class="comment">// A2 索引槽存放是的 内容行的编号. 每次新增一个index的时候 index_header中的index_count就需要增加一个.然后存放在对应的文件槽内。</span></span><br><span class="line">    <span class="comment">// Q3 content 固定长度后包含哪些东西?一个索引文件中包含哪些数据</span></span><br><span class="line">    <span class="comment">// A3 content 内容包含.</span></span><br><span class="line">    <span class="comment">// 1. ketHash.该内容行所使用的hash值. ====&gt;类似于使用了分表也要记录根据什么条件进行的分表</span></span><br><span class="line">    <span class="comment">// 2. phyOffset 内容行commitLog 物理地址 ====&gt;为了寻找到具体的消息</span></span><br><span class="line">    <span class="comment">// 3. timeDiff 内容行commitLog 落库时间相对于索引文件的间隔时间====&gt; 用于过期？间隔时间短的表示最初进入的. 当出现hash冲突的时候提供一个去处逻辑？</span></span><br><span class="line">    <span class="comment">// 4. slotValue 存储的上一次hash计算出的 文件行具体地址。 ☆☆☆☆☆ 重要.</span></span><br><span class="line">    <span class="comment">// Q4 从上描述得到的信息可以该方案有一个严重的弊端(仅仅使用content_index去定位数据). 当出现hash冲突后怎么去解决？？？</span></span><br><span class="line">    <span class="comment">// A4 在hash冲突的行内. 记录上一次文件行的content_index,这样在一个hash槽内就组成了一个链表结构。并且这部分是属于头插法====&gt;</span></span><br><span class="line">    <span class="comment">//       将最新的记录插入到hash槽内, 再辅佐于keyHash真实的值. 就可以定位到数据了</span></span><br><span class="line">    <span class="comment">//  举例. 现在有四个key. 这四个key对应的&#123;k0,k1,k2,k3&#125; hash都落入到了一个hash_slot[1]中</span></span><br><span class="line">    <span class="comment">//  那么hash_slot[1] 的变化在进行四次插入后有如下变化：</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//  hash_slot[1]=content0_index =&gt; hash_slot[1]=content1_index =&gt; hash_slot[1]=content2_index =&gt; hash_slot[1]=content2_index</span></span><br><span class="line">    <span class="comment">//         |-------------[hash_slot[1]]--------------------------------------|</span></span><br><span class="line">    <span class="comment">//         | 索引行,行标index_count|内容   |hash值|上一个索引行,航标   |</span></span><br><span class="line">    <span class="comment">//         |content0_index|content0_data|keyHash_0|-1            |</span></span><br><span class="line">    <span class="comment">//         |content1_index|content1_data|keyHash_1|content0_index|</span></span><br><span class="line">    <span class="comment">//         |content2_index|content2_data|keyHash_2|content1_index|</span></span><br><span class="line">    <span class="comment">//         |content3_index|content3_data|keyHash_3|content2_index|</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 逻辑上 索引文件的 索引槽头部和索引内容是一个 hashmap. 采用的是头插法</span></span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure>




<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">putKey</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> <span class="type">long</span> phyOffset, <span class="keyword">final</span> <span class="type">long</span> storeTimestamp)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.indexHeader.getIndexCount() &lt; <span class="built_in">this</span>.indexNum) &#123;</span><br><span class="line">            <span class="comment">// 计算这个key的字符串hash</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">keyHash</span> <span class="operator">=</span> indexKeyHashMethod(key);</span><br><span class="line">            <span class="comment">// 计算出hash所在的桶是多少</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">slotPos</span> <span class="operator">=</span> keyHash % <span class="built_in">this</span>.hashSlotNum;</span><br><span class="line">            <span class="comment">//   抽象的概念的 桶坐标？.绝对地址？？？不是很明白这个.====&gt;hashSlotNum 这个是配置的. 通过indexService传入,indexService中的由MessageStoreConfig传入。</span></span><br><span class="line">            <span class="comment">// 通过简单计算理解 absSlotPos表示的是 在Index这个文件中. 的物理地址。其中slotPos是逻辑地址,表示的是桶的序号.然后因为每个slot是固定长度的.</span></span><br><span class="line">            <span class="comment">//   那么就可以通过slotPos*slotSize的方式得到这个数据的绝对地址 再然后因为每个index文件有头部信息, 这个需要跳过的,</span></span><br><span class="line">            <span class="comment">// 一般这么操作,是因为数据最终是需要落地在文件中的. 采用一行一个数据的方式是可以的,但是这样的数据是非紧凑型的.</span></span><br><span class="line">            <span class="comment">//   那么就引发了一个问题. 为什么index需要使用这样的方式进行 读写？对于index这样高频读写的数据, 不太适合</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">absSlotPos</span> <span class="operator">=</span> IndexHeader.INDEX_HEADER_SIZE + slotPos * hashSlotSize;</span><br><span class="line"></span><br><span class="line">            <span class="type">FileLock</span> <span class="variable">fileLock</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 从被注释掉的痕迹看.  原本是打算 文件锁的.☆☆☆☆ 文件锁是系统编程基础,需要着重看</span></span><br><span class="line">                <span class="comment">// fileLock = this.fileChannel.lock(absSlotPos, hashSlotSize,</span></span><br><span class="line">                <span class="comment">// false);</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">slotValue</span> <span class="operator">=</span> <span class="built_in">this</span>.mappedByteBuffer.getInt(absSlotPos);</span><br><span class="line">                <span class="comment">// 存在hash冲突如何处理</span></span><br><span class="line">                <span class="keyword">if</span> (slotValue &lt;= invalidIndex || slotValue &gt; <span class="built_in">this</span>.indexHeader.getIndexCount()) &#123;</span><br><span class="line">                    slotValue = invalidIndex;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">long</span> <span class="variable">timeDiff</span> <span class="operator">=</span> storeTimestamp - <span class="built_in">this</span>.indexHeader.getBeginTimestamp();</span><br><span class="line"></span><br><span class="line">                timeDiff = timeDiff / <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.indexHeader.getBeginTimestamp() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    timeDiff = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (timeDiff &gt; Integer.MAX_VALUE) &#123;</span><br><span class="line">                    timeDiff = Integer.MAX_VALUE;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (timeDiff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    timeDiff = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">absIndexPos</span> <span class="operator">=</span></span><br><span class="line">                    IndexHeader.INDEX_HEADER_SIZE + <span class="built_in">this</span>.hashSlotNum * hashSlotSize</span><br><span class="line">                        + <span class="built_in">this</span>.indexHeader.getIndexCount() * indexSize;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.mappedByteBuffer.putInt(absIndexPos, keyHash);</span><br><span class="line">                <span class="built_in">this</span>.mappedByteBuffer.putLong(absIndexPos + <span class="number">4</span>, phyOffset);</span><br><span class="line">                <span class="built_in">this</span>.mappedByteBuffer.putInt(absIndexPos + <span class="number">4</span> + <span class="number">8</span>, (<span class="type">int</span>) timeDiff);</span><br><span class="line">                <span class="built_in">this</span>.mappedByteBuffer.putInt(absIndexPos + <span class="number">4</span> + <span class="number">8</span> + <span class="number">4</span>, slotValue);</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.mappedByteBuffer.putInt(absSlotPos, <span class="built_in">this</span>.indexHeader.getIndexCount());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.indexHeader.getIndexCount() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.indexHeader.setBeginPhyOffset(phyOffset);</span><br><span class="line">                    <span class="built_in">this</span>.indexHeader.setBeginTimestamp(storeTimestamp);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (invalidIndex == slotValue) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.indexHeader.incHashSlotCount();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">this</span>.indexHeader.incIndexCount();</span><br><span class="line">                <span class="built_in">this</span>.indexHeader.setEndPhyOffset(phyOffset);</span><br><span class="line">                <span class="built_in">this</span>.indexHeader.setEndTimestamp(storeTimestamp);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;putKey exception, Key: &quot;</span> + key + <span class="string">&quot; KeyHashCode: &quot;</span> + key.hashCode(), e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fileLock != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fileLock.release();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;Failed to release the lock&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Over index file capacity: index count = &quot;</span> + <span class="built_in">this</span>.indexHeader.getIndexCount()</span><br><span class="line">                + <span class="string">&quot;; index max num = &quot;</span> + <span class="built_in">this</span>.indexNum);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>中间件</category>
        <category>rocketmq</category>
      </categories>
      <tags>
        <tag>rocketmq</tag>
        <tag>源码精讲</tag>
      </tags>
  </entry>
  <entry>
    <title>rocket存储引擎[4]-查询index文件</title>
    <url>/2022/05/02/%E4%B8%93%E9%A2%98/rockemq%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/rocket%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%5B4%5D-%E6%9F%A5%E8%AF%A2index%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="查询Index文件"><a href="#查询Index文件" class="headerlink" title="查询Index文件"></a>查询Index文件</h2><span id="more"></span> 

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[<span class="number">20220502</span>]-commitLog文件初探四-查询Index索引文件。</span><br><span class="line"></span><br><span class="line">在`commitlog文件初探三-构建Index索引文件`中有介绍index文件构成其中包括 内容index,diffTime,keyHash等,还介绍了index文件本质上是一个hashmap在文件上的表示.</span><br><span class="line">在上次遗留了几个点</span><br><span class="line"><span class="number">1.</span> diffTime是做什么的?为什么要存储这个数据?可以不存储这个数据吗?</span><br><span class="line"><span class="number">2.</span> index是如何处理hash冲突的?</span><br><span class="line"><span class="number">3.</span> 为什么index文件的中处理hash冲突采用的是头插法?尾插法不可以吗?</span><br><span class="line"><span class="number">4.</span> 多并发写index文件.</span><br><span class="line"><span class="number">5.</span> 为什么index文件要持有资源引用数据 resourceRefCount</span><br><span class="line"></span><br><span class="line">针对以上问题的解释:</span><br><span class="line"><span class="number">1.</span> diffTime上次简单描述了作用是作为一个 回收数据时的一句,可以针对历史久远数据进行回收. 这个概念如果放在多个文件中,或者是内存概念中是合理的, 但是放在单文件中, 不合理的地方凸显出来了. 那就是diffTime原则上是递增的.</span><br><span class="line">  <span class="number">1</span>). 新数据一定会大于老数据的DiffTime.</span><br><span class="line">  <span class="number">2</span>). 新数据是追加在老数据行后的.</span><br><span class="line">根据这两个特性, 如果作为回收数据依靠, 那么就只有回写indexCount的情况下才会使用到前置数据了, 不然将导致多次一举的可能.但是indexCount又是一直递增的. 所以这个可能性被驳回了。</span><br><span class="line">那么还有什么可能吗? 答案是有的, 那就是按照时间存储数据,新增数据diffTime越大. 越靠后</span><br><span class="line"><span class="number">2.</span> index中处理hash冲突的办法就是将针对到slot_index的数据制作成链表结构[拉链法],但是针对hashKey一样的数据没有做额外的处理.  ☆☆☆☆☆</span><br><span class="line">   之前有讲过index是一个hashmap文件化的表示. 但是这部分只是针对于解决冲突的前半部分. 后半部分对于持有同样的hashKey将新增一样的记录</span><br><span class="line">   那么问题就来了. 如果两个key不一样,但是keyHash一样. 那么在index中会存在几条数据? 答案是两条,index文件不会去做[去重]的动作。</span><br><span class="line"><span class="number">3.</span> index文件采用头插法是为什么呢? 这个是一个经验值普遍业务做法. 这个关键因素在于diffTime.</span><br><span class="line">   根据上文<span class="number">1.</span>提到diffTime新数据,数值越大. 按照时间范围查询的时候,获取新数据比获取旧数据更可靠. 此外在做查询`selectPhyOffset`时,有一个maxNum,如果从旧数据查询, 那么就无法获取到最新数据了。</span><br><span class="line"><span class="number">4.</span> 此前rocketmq对于index文件并发写是做了文件锁的,但是后续将这部分代码注释掉了,原因可能是影响了读写性能了===&gt;大部分情况下是不会出现这个并发错误的,因为目前看来只有一个RePutService 线程在对这个文件写入。. 文件行锁 使用的是FileLock.针对某个 地址,这个地址在rocketmq中选用的是 每个索引行的起始地址. 使用起始地址也是结合上文的索引行固定行大小的结果</span><br><span class="line"><span class="number">5.</span> 资源引用数据, 个人认为是为了index文件过期删除做准备的.</span><br><span class="line">  盲猜这个过期删除步骤是一个新的线程操作. 如果有index文件写/查 的过程中进行删除,那么将无法获取到准确数据,所以在使用到该index文件时,就进行类似上锁的操作. 在做清除工作的时候略过该文件. 清理下一个文件.</span><br><span class="line"></span><br><span class="line">本次阅读重点:</span><br><span class="line">    在解释头插法的时候.有一个重要的概念【归纳法】</span><br><span class="line">    <span class="number">1.</span> 在查询一个范围数据中. 如果该数据集是有序的. 那么 假设 A集合中有a1,a2,a3,a4,a5 其中a3,不符合规则,那么a4,a5也同样不符合规则,就不需要查询了</span><br><span class="line">    这一点针对 diffTime的时间范围查询.</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 批量查询对应key中的索引信息.</span></span><br><span class="line">     <span class="comment">// 使用#phyOffsets变量透出, 这部分本来可以使用返回值的. 使用共享变量可以减少list的创建以及多list合并情况。, maxNum表示当前查询的消息最大个数</span></span><br><span class="line">     <span class="comment">// begin和end 表示查询索引的时间范围. 索引有效时间根据 index存储的索引行内容diffTime记录, 该记录使用的是 相对于index的beginTime的时间.</span></span><br><span class="line">     <span class="comment">// 然后就是查询方式是按照hash的方式查询的</span></span><br><span class="line">     <span class="comment">// 当出现了hash一样的情况下, 也将数据返回, 目前需要做的是粗略的定位, 不需要做精准定位</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">//  hash_slot[1]=content0_index =&gt; hash_slot[1]=content1_index =&gt; hash_slot[1]=content2_index =&gt; hash_slot[1]=content2_index</span></span><br><span class="line">     <span class="comment">//  ===&gt;hash_slot[1]=content3_index===&gt;hash_slot[1]=content4_index===&gt;hash_slot[1]=content5_index===&gt;hash_slot[1]=content6_index</span></span><br><span class="line">     <span class="comment">//  ===&gt;hash_slot[1]=content7_index</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">//         |-------------[hash_slot[1]]--------------------------------------|</span></span><br><span class="line">     <span class="comment">//         | 索引行,行标index_count|内容   |hash值|上一个索引行,航标   |diff_time</span></span><br><span class="line">     <span class="comment">//         |content0_index|content0_data|keyHash_0|-1            |  01 |</span></span><br><span class="line">     <span class="comment">//         |content1_index|content1_data|keyHash_1|content0_index|  10 |</span></span><br><span class="line">     <span class="comment">//         |content2_index|content2_data|keyHash_2|content1_index|  20 |</span></span><br><span class="line">     <span class="comment">//         |content3_index|content3_data|keyHash_3|content2_index|  30 |</span></span><br><span class="line">     <span class="comment">//         |content4_index|content4_data|keyHash_1|content3_index|  40 |</span></span><br><span class="line">     <span class="comment">//         |content5_index|content5_data|keyHash_2|content4_index|  50 |</span></span><br><span class="line">     <span class="comment">//         |content6_index|content6_data|keyHash_3|content5_index|  60 |</span></span><br><span class="line">     <span class="comment">//         |content7_index|content7_data|keyHash_1|content6_index|  70 |</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">// 按照图中所给 其中按照头插法, 最终记录在索引头的hash_slot[1]为content7_index的行号</span></span><br><span class="line">     <span class="comment">// 其中数据按照 keyHash_0,keyHash_1,keyHash_2,keyHash_3 真实hash值存储在索引行中。</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">// 在需要查询具体数据的时候</span></span><br><span class="line">     <span class="comment">//  1. 查询出具体的slot_index找到索引行.</span></span><br><span class="line">     <span class="comment">//  2. 按照索引行给出的单链表, 将逐个遍历下去, 找到和搜索key_hash相等的索引行(☆☆☆☆☆☆☆)</span></span><br><span class="line">     <span class="comment">//  2.1 按照索引行给出数据查找到后不会立即返回, 会继续按照索引行的链表方向查找到最底部.</span></span><br><span class="line">     <span class="comment">//  2.2 虽说上述描述的会按照链表的方向一直查询下去, 但是当查询到time不符合了就会停止搜索====&gt;这里面有一个很重要的概念为。</span></span><br><span class="line">     <span class="comment">//  数据是按照头插法插入的, 也就是说最顶部的为最新数据, 只要其中一项不符合时间范围, 之后的一定会不符合时间范围.</span></span><br><span class="line">     <span class="comment">//  即 头插法不仅仅是index坐标的倒叙, 更是插入时间的倒叙方式. 那么按照头插法是很合理的要求了。</span></span><br><span class="line">     <span class="comment">//     如果按照尾插法===&gt;虽然可以解决hash冲突的情况,但是使用时间搜索的时候. 就必须先遍历久远的数据再遍历新数据.</span></span><br><span class="line">     <span class="comment">//     极端场景下查询的数据范围更加的靠后, 并且该链路很长, 就花费了很多无用功。=====&gt; 那么这个是经验值吗？</span></span><br><span class="line">     <span class="comment">//  所以 这部分可以使用数学中的【归纳法】对后续的数据进行假设,得出结论</span></span><br><span class="line">     <span class="comment">//  3.将符合条件的物理地址填充到 集合中返回</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">// 按照上述步骤</span></span><br><span class="line">     <span class="comment">//   查询一个 key 其keyHash 为 keyHash_1 .那么就会进行遍历, 假设时间查询截止到 100~50</span></span><br><span class="line">     <span class="comment">//   从 content7_index开始. 因为这个值是存放在slot_index[1]中的. 符合条件添加[keyHash]符合,[diffTime]符合</span></span><br><span class="line">     <span class="comment">//   遍历 content6_index.  不符合条件,[keyHash]不符合,[diffTime]符合</span></span><br><span class="line">     <span class="comment">//   遍历 content5_index.  不符合条件,[keyHash]不符合,[diffTime]符合</span></span><br><span class="line">     <span class="comment">//   遍历 content4_index.  不符合条件,[keyHash]符合,[diffTime]符合, 因为时间不符合</span></span><br><span class="line">     <span class="comment">//   归纳假设, 因为content4_index中时间不符合, 又因为content4_index中事件均大于 content3,content2,content1,content0,所以下方不需要进行遍历</span></span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">     <span class="comment">// 根据上述步骤 可以查询到的有效数据为 content7_index中的物理地址了。</span></span><br><span class="line">     <span class="comment">//</span></span><br></pre></td></tr></table></figure>




<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectPhyOffset</span><span class="params">(<span class="keyword">final</span> List&lt;Long&gt; phyOffsets, <span class="keyword">final</span> String key, <span class="keyword">final</span> <span class="type">int</span> maxNum,</span></span><br><span class="line"><span class="params">    <span class="keyword">final</span> <span class="type">long</span> begin, <span class="keyword">final</span> <span class="type">long</span> end, <span class="type">boolean</span> lock)</span> &#123;</span><br><span class="line">    <span class="comment">// 这里使用hold这类的情况, 其实是为了做引用标记, 防止在插入/查新index数据过程中, 数据被清除了.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.mappedFile.hold()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">keyHash</span> <span class="operator">=</span> indexKeyHashMethod(key);</span><br><span class="line">        <span class="type">int</span> <span class="variable">slotPos</span> <span class="operator">=</span> keyHash % <span class="built_in">this</span>.hashSlotNum;</span><br><span class="line">        <span class="type">int</span> <span class="variable">absSlotPos</span> <span class="operator">=</span> IndexHeader.INDEX_HEADER_SIZE + slotPos * hashSlotSize;</span><br><span class="line">        <span class="comment">// 比较疑惑的一个情况是, 在putKey中也看到了fileLock的存在, 但是都被注释了. 这个是为什么呢?</span></span><br><span class="line">        <span class="comment">// 并发写的话不是需要持有文件锁才能对文件数据更好操作吗???????</span></span><br><span class="line">        <span class="comment">// 盲猜！！！以前的设计是不处理hash冲突的. 只要有hash冲突了,</span></span><br><span class="line">        <span class="comment">//     那么就进行覆盖,所以这部分需要fileLock锁定某一行的绝对地址,之所以是绝对地址的起始部分.是因为更早期就固定了索引行的大小</span></span><br><span class="line">        <span class="comment">// 使用hash,冲突使用hash链表的时候 就更改了这一写法？？？？？？</span></span><br><span class="line">        <span class="type">FileLock</span> <span class="variable">fileLock</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (lock) &#123;</span><br><span class="line">                <span class="comment">// fileLock = this.fileChannel.lock(absSlotPos,</span></span><br><span class="line">                <span class="comment">// hashSlotSize, true);</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">slotValue</span> <span class="operator">=</span> <span class="built_in">this</span>.mappedByteBuffer.getInt(absSlotPos);</span><br><span class="line">            <span class="comment">// if (fileLock != null) &#123;</span></span><br><span class="line">            <span class="comment">// fileLock.release();</span></span><br><span class="line">            <span class="comment">// fileLock = null;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (slotValue &lt;= invalidIndex || slotValue &gt; <span class="built_in">this</span>.indexHeader.getIndexCount()</span><br><span class="line">                || <span class="built_in">this</span>.indexHeader.getIndexCount() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">nextIndexToRead</span> <span class="operator">=</span> slotValue; ; ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (phyOffsets.size() &gt;= maxNum) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 解析捞数据的过程====&gt;按照index索引行协议来就行了</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">absIndexPos</span> <span class="operator">=</span></span><br><span class="line">                        IndexHeader.INDEX_HEADER_SIZE + <span class="built_in">this</span>.hashSlotNum * hashSlotSize</span><br><span class="line">                            + nextIndexToRead * indexSize;</span><br><span class="line"></span><br><span class="line">                    <span class="type">int</span> <span class="variable">keyHashRead</span> <span class="operator">=</span> <span class="built_in">this</span>.mappedByteBuffer.getInt(absIndexPos);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">phyOffsetRead</span> <span class="operator">=</span> <span class="built_in">this</span>.mappedByteBuffer.getLong(absIndexPos + <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="type">long</span> <span class="variable">timeDiff</span> <span class="operator">=</span> (<span class="type">long</span>) <span class="built_in">this</span>.mappedByteBuffer.getInt(absIndexPos + <span class="number">4</span> + <span class="number">8</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">prevIndexRead</span> <span class="operator">=</span> <span class="built_in">this</span>.mappedByteBuffer.getInt(absIndexPos + <span class="number">4</span> + <span class="number">8</span> + <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (timeDiff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    timeDiff *= <span class="number">1000L</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="type">long</span> <span class="variable">timeRead</span> <span class="operator">=</span> <span class="built_in">this</span>.indexHeader.getBeginTimestamp() + timeDiff;</span><br><span class="line">                    <span class="type">boolean</span> <span class="variable">timeMatched</span> <span class="operator">=</span> (timeRead &gt;= begin) &amp;&amp; (timeRead &lt;= end);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (keyHash == keyHashRead &amp;&amp; timeMatched) &#123;</span><br><span class="line">                        phyOffsets.add(phyOffsetRead);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (prevIndexRead &lt;= invalidIndex</span><br><span class="line">                        || prevIndexRead &gt; <span class="built_in">this</span>.indexHeader.getIndexCount()</span><br><span class="line">                        || prevIndexRead == nextIndexToRead || timeRead &lt; begin) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    nextIndexToRead = prevIndexRead;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;selectPhyOffset exception &quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileLock != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileLock.release();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Failed to release the lock&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.mappedFile.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>中间件</category>
        <category>rocketmq</category>
      </categories>
      <tags>
        <tag>rocketmq</tag>
        <tag>源码精讲</tag>
      </tags>
  </entry>
  <entry>
    <title>spring三级缓存case</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/spring/spring%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98case/</url>
    <content><![CDATA[<h2 id="spring三级缓存case"><a href="#spring三级缓存case" class="headerlink" title="spring三级缓存case"></a>spring三级缓存case</h2><h1 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h1><p>一级缓存可以满足非增强bean的流程<br>case1: A-&gt;B,B-&gt;A 原始bean在一级缓存可以完整依赖,<br>预期: 一级缓存中存在<br>    普通A,持有普通B<br>    普通B,持有普通A<br>实际: 一级缓存中存在<br>    普通A,持有普通B<br>    普通B,持有普通A<br>结果: 符合预期</p>
<p>PS:一级缓存的添加点有两处,<br>   第一处: 在创建过程中添加一次, 这次是为了解决循环依赖中因为相互依赖所引起的递归死循环问题<br>   第二处: 在创建完成后, 添加到一级缓存中-&gt;此处仅仅是为了冗余或者是以往的逻辑都是在第二处中就创建</p>
<p>case2: A-&gt;B,B-&gt;A A和B都进行了AOP(beanPostProccor)过程.<br>预期: 一级缓存中存在<br>    增强A,持有增强B<br>    增强B,持有增强A<br>实际: 一级缓存中存在<br>    增强A,持有增强B<br>    增强B,持有普通A<br>结果: 不符合预期,原因在下方标注<br>原因: A-&gt;B-&gt;A 的过程中,<br>        1. 获取到了普通A给到普通B<br>     A-&gt;B 普通B获取到普通A后进行后置处理器,变为了增强B 此时还没有添加到一级缓存中<br>     A-&gt;B 在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有普通A],[普通A,没有持有任务]<br>     A    普通A获取到增强B后进行后置处理器,变为了增强A 此时还没有添加到一级缓存中<br>     A    在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有普通A],[普通A,增强B]</p>
<p>解决方式有:  A-&gt;B-&gt;A 的过程中,<br>        1. 将A进行增强,获得到增强A给到普通B<br>     A-&gt;B 普通B获取到增强A后进行后置处理器,变为了增强B 此时还没有添加到一级缓存中<br>     A-&gt;B 在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有增强A],[增强A,没有持有任务]<br>     A    普通A获取到增强B后进行后置处理器,变为了增强A 此时还没有添加到一级缓存中<br>     A    在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有增强A],[增强A2,增强B]<br>    因为在返回的过程中会将A在此增强, 所以再次的解决方法放入到下方,[引入新问题]<br>      A-&gt;B-&gt;A 的过程中,<br>        1. 将A进行增强,获得到增强A给到普通B,[后置处理器将数据进行了缓存]<br>     A-&gt;B 普通B获取到增强A后进行后置处理器,变为了增强B 此时还没有添加到一级缓存中<br>     A-&gt;B 在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有增强A1],[增强A1,没有持有任务]<br>     A    普通A获取到增强B后进行后置处理器,[后置处理器早进行了缓存,所以此时拿到的是增强A1]<br>     A    在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有增强A1],[增强A1,增强B]<br>    此处是解决了分别得到增强A1和A2的问题,但是不满足新的条件[三方循环依赖],讨论放在下方</p>
<p>case3: A-&gt;B A-&gt;C B-&gt;A C-&gt;A A,B,C都进行了AOP<br>期望: 一级缓存中存在<br>    增强C,持有增强A1<br>    增强B,持有增强A1<br>    增强A,持有增强B<br>    增强A,持有增强C</p>
<p>什么都不修改</p>
<p>原因: A-&gt;B-&gt;A 的过程中,<br>        1. 获取到了普通A给到普通B<br>     A-&gt;B 普通B获取到普通A后进行后置处理器,变为了增强B 此时还没有添加到一级缓存中<br>     A-&gt;B 在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有普通A],[普通A,没有持有任务]<br>     A-&gt;C-&gt;A 的过程中<br>        2. 获取到普通A给到普通C<br>     A-&gt;C 普通C获取到普通A后进行后置处理器,变为了增强C 此时还没有添加到一级缓存中<br>     A-&gt;C 在执行所有完成后,将增强C添加到单例池中, 此时单例池存在 [增强B,持有普通A],[增强C,持有普通A],[普通A,没有持有任务]<br>     A    普通A获取到增强B后进行后置处理器,[后置处理器早进行了缓存,所以此时拿到的是增强A1]<br>     A    在执行所有完成后,将增强B添加到单例池中, 此时单例池存在 [增强B,持有增强A1],[增强A1,增强B]</p>
]]></content>
  </entry>
  <entry>
    <title>spring三级缓存流程</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/spring/spring%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<p>spring获取一个bean的过程</p>
<p>getBean-&gt;doGetBean-&gt;</p>
<ol>
<li>检查现在是否能获取到一个getSingleTon单例对象<br>1.1 此阶段还没有进入创建流程,所以在getSingleTon中没有获取到一级缓存的Bean则直接放回null&#x3D;&#x3D;&#x3D;&gt;此处的getSingleTon是通过名称获取的, 不管你是什么</li>
<li>如果能获取到将单例对象返回</li>
<li>如果不能获取到则执行createBean的流程(该流程比较大)</li>
</ol>
<p>createBean流程<br>在org.springframework.beans.factory.support.DefaultSingletonBeanRegistry 内部此流程同样称之为 getSingleTon,携带了一个创建工具的.<br>读作getSingleTon写作createSingleTon getSingleton(java.lang.String, org.springframework.beans.factory.ObjectFactory&lt;?&gt;)</p>
<ol>
<li>将getSingleTon解构后可以得到</li>
</ol>
<p>Q: 既然getSingleTon底层就是createBean的操作,那么为什么还需要多次一举呢？<br>A: 之所以需要 getSingleton(java.lang.String, org.springframework.beans.factory.ObjectFactory&lt;?&gt;) 这个步骤,是为了更安全的创建bean对象,诚然ObjectFactory 是createBean的具体流程,但是在创建bean之前需要进行安全校验,<br>    比如下文中的双重锁校验,避免重复创建,获取创建标记锁等步骤</p>
<p>2.1 双重校验 double check,此处使用锁singleObjects,然后执行<br>   单纯从缓存中是否可以拿到对象,如果可以拿到对象则直接返回. 总做和 doGetBean中的一样.只不过在此流程中的一定是 singleObjects中不存在的</p>
<p>2.2 开始标记当前正在创建对象, 获取创建对bean的锁 LOCK,使用hashmap记录信号量 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;创建bean锁<br>2.3&#x3D;&#x3D;&#x3D;&gt;开始创建bean</p>
]]></content>
  </entry>
  <entry>
    <title>spring循环依赖</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/spring/spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/</url>
    <content><![CDATA[<h1 id="Spring循环依赖"><a href="#Spring循环依赖" class="headerlink" title="Spring循环依赖"></a>Spring循环依赖</h1><p>背景: 介绍一个实例创建的经过</p>
<ol>
<li>现阶段spring的解决方案</li>
<li>早期spring的解决方案</li>
</ol>
<p>无缓存<br>作用, 解决了什么问题,带来了什么问题?</p>
<p>一级缓存<br>一级缓存是什么? 解决了什么问题,带来了什么问题?<br>在什么时候时候二级缓存,一级缓存的多种实现</p>
<p>二级缓存<br>二级缓存是什么? 解决了什么问题,带来了什么问题?<br>在什么时候时候二级缓存,二级缓存的多种实现</p>
<p>三级缓存<br>三级缓存是什么? 解决了什么问题,带来了什么问题?<br>在什么时候时候三级缓存,三级缓存的多种实现</p>
<p>结论:</p>
]]></content>
  </entry>
  <entry>
    <title>简说spring源码1-spring-bean</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/spring/%E7%AE%80%E8%AF%B4spring%E6%BA%90%E7%A0%81%5B1%5D-%E7%AE%80%E5%8D%95%E8%81%8A%E8%81%8ABeanFactory/</url>
    <content><![CDATA[<h1 id="简说spring源码1-spring-bean"><a href="#简说spring源码1-spring-bean" class="headerlink" title="简说spring源码1-spring-bean"></a>简说spring源码1-spring-bean</h1><h2 id="模块结构"><a href="#模块结构" class="headerlink" title="模块结构"></a>模块结构</h2><p><img src="/./assert/spring-bean%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.jpg"></p>
]]></content>
  </entry>
  <entry>
    <title>阅读spring早期源代码</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/spring/%E9%98%85%E8%AF%BBspring%E6%97%A9%E6%9C%9F%E6%BA%90%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<h1 id="阅读spring早期源代码"><a href="#阅读spring早期源代码" class="headerlink" title="阅读spring早期源代码"></a>阅读spring早期源代码</h1><ul>
<li><a href="#%E9%98%85%E8%AF%BBspring%E6%97%A9%E6%9C%9F%E6%BA%90%E4%BB%A3%E7%A0%81">阅读spring早期源代码</a><ul>
<li><a href="#%E8%83%8C%E6%99%AF">背景</a></li>
<li><a href="#%E9%98%85%E8%AF%BB%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA">阅读环境的搭建</a><ul>
<li><a href="#%E5%87%86%E5%A4%87">准备</a></li>
</ul>
</li>
<li><a href="#%E9%98%85%E8%AF%BB%E8%B5%84%E6%96%99">阅读资料</a><ul>
<li><a href="#%E6%8E%A8%E8%8D%90%E5%9B%BE%E4%B9%A6">推荐图书</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>希望通过阅读spring代码,掌握spring对于bean,aop,context等核心功能,有助于基于spring的现有功能进行业务开发以及业务排错.<br>比如: </p>
<ol>
<li>了解FactoryBean,可以了解到MyBatis-Spring,dubbo-spring等框架的启动注册流程</li>
<li>了解BeanFactory,可以了解到Spring对于Bean的生命周期</li>
<li>了解</li>
</ol>
<h2 id="阅读环境的搭建"><a href="#阅读环境的搭建" class="headerlink" title="阅读环境的搭建"></a>阅读环境的搭建</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>jdk1.4,早期代码语法有很多按照现在编译器来看是不合法的的。所以一定要准备好1.4的版本<br><a href="https://www.oracle.com/java/technologies/java-archive-javase-v14-downloads.html">https://www.oracle.com/java/technologies/java-archive-javase-v14-downloads.html</a><br>PS: 不要试图使用1.4版本以上的jdk. 代码中存在使用<code>enum</code>作为<code>标识符</code>的情况,在jdk1.5版本以上<code>enum</code>是作为关键字的</p>
<p>操作系统:linux, 目前能找到支持的也只有linux和windows有1.4的安装包,为了方便使用linux</p>
<p>环境变量设置JAVA_HOME</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME=/home/ubuntu/downloads/j2sdk1.4.2_19 </span><br><span class="line">export PATH=$JAVA_HOME/bin:$JAVA_HOME/lib:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证</span></span><br><span class="line">java -version </span><br></pre></td></tr></table></figure>

<p>设置ant环境变量</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ANT_HOME=./lib/ant</span><br></pre></td></tr></table></figure>


<p>编译代码<br>早期spring使用ant作为构建代码的工具, 其中在项目中已经含有了可以构建当前1.4版本的ant工具 在<code>./lib/ant</code> 中<br>或者自行下载安装ant1.6.1的版本</p>
<p>Apache Ant version 1.6.1 compiled on February 12 2004</p>
<p>编写build.sh脚本用作后续方便操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># replace JAVA_HOME with jdk1.4</span></span><br><span class="line"><span class="comment"># export JAVA_HOME_4=~/downloads/j2sdk1.4.2_19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $1 param</span></span><br><span class="line"><span class="comment">## eg: modulejars package all module</span></span><br><span class="line"><span class="comment">## eg: srczip package all source to zip</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JAVA_HOME_4</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=<span class="variable">$JAVA_HOME_4</span></span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">jvm_jar=<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ant_jar=./lib/ant/ant.jar:./lib/ant/ant-launcher.jar:./lib/ant/ant-trax.jar:./lib/ant/ant-junit.jar</span><br><span class="line">junit_jar=./lib/junit/junit.jar</span><br><span class="line">clover_jar=./lib/clover/clover.jar</span><br><span class="line"></span><br><span class="line">startup_jar=<span class="variable">$jvm_jar</span>:<span class="variable">$ant_jar</span>:<span class="variable">$junit_jar</span>:<span class="variable">$clover_jar</span></span><br><span class="line"><span class="variable">$JAVA_HOME</span>/bin/java -<span class="built_in">cp</span> <span class="variable">$startup_jar</span>  org.apache.tools.ant.Main <span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME=/home/ubuntu/downloads/j2sdk1.4.2_19</span><br><span class="line">export PATH=$JAVA_HOME/bin:$JAVA_HOME/lib:$PATH </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包源代码</span></span><br><span class="line">./build.sh srczip </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按照模块编译代码</span></span><br><span class="line">./build.sh modulejars</span><br></pre></td></tr></table></figure>


<h2 id="阅读资料"><a href="#阅读资料" class="headerlink" title="阅读资料"></a>阅读资料</h2><h3 id="推荐图书"><a href="#推荐图书" class="headerlink" title="推荐图书"></a>推荐图书</h3><ul>
<li>J2EE设计开发编程指南(Expert One-on-One J2EE Design and Development)<br>推荐原因: spring设计时参考的设计指南,对于理解spring的设计思路有帮助</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>排查cpp语言中引用传递和值传递的区分</title>
    <url>/2022/10/09/%E4%B8%93%E9%A2%98/%E6%8E%92%E6%9F%A5cpp%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E5%92%8C%E5%80%BC%E4%BC%A0%E9%80%92%E7%9A%84%E5%8C%BA%E5%88%86/%E6%8E%92%E6%9F%A5cpp%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E5%92%8C%E5%80%BC%E4%BC%A0%E9%80%92%E7%9A%84%E5%8C%BA%E5%88%86/</url>
    <content><![CDATA[<p>java使用的是 指针传递, 不是指传递,也不是引用传递.</p>
]]></content>
  </entry>
  <entry>
    <title>部署Hexo</title>
    <url>/2022/04/30/%E9%83%A8%E7%BD%B2hexo/</url>
    <content><![CDATA[<h2 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h2><ul>
<li>内容使用<code>package.json</code>转化而成<span id="more"></span> 
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install gulp</span><br><span class="line">npm install hexo</span><br><span class="line">npm install hexo-abbrlink</span><br><span class="line">npm install hexo-deployer-git</span><br><span class="line">npm install hexo-generator-archive</span><br><span class="line">npm install hexo-generator-category</span><br><span class="line">npm install hexo-generator-feed</span><br><span class="line">npm install hexo-generator-index</span><br><span class="line">npm install hexo-generator-searchdb</span><br><span class="line">npm install hexo-generator-sitemap</span><br><span class="line">npm install hexo-generator-tag</span><br><span class="line">npm install hexo-helper-live2d</span><br><span class="line">npm install hexo-inject</span><br><span class="line">npm install hexo-renderer-ejs</span><br><span class="line">npm install hexo-renderer-kramed</span><br><span class="line">npm install hexo-renderer-marked</span><br><span class="line">npm install hexo-renderer-stylus</span><br><span class="line">npm install hexo-server</span><br><span class="line">npm install hexo-theme-landscape</span><br><span class="line">npm install hexo-theme-next</span><br><span class="line">npm install hexo-wordcount</span><br><span class="line">npm install live2d-widget-model-koharu</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Next主题配置"><a href="#Next主题配置" class="headerlink" title="Next主题配置"></a>Next主题配置</h2><h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-theme-next</span><br></pre></td></tr></table></figure>

<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><ul>
<li>新版Next配合hexo配置,本次配置Next采用8.x版本,hexo采用6.x版本,因旧版本配置方式需要clone一份theme到本地,不方便升级,所以后续的hexo主题采用<code>_config.[theme_name].yml</code>的方式配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"><span class="comment"># It&#x27;s recommended to use Alternate Theme Config to configure NexT</span></span><br><span class="line"><span class="comment"># Modifying this file may result in merge conflict</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/getting-started/configuration</span></span><br><span class="line"><span class="comment"># ===============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Theme Core Configuration Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow to cache content generation.</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove unnecessary files after hexo generate.</span></span><br><span class="line"><span class="attr">minify:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define custom file paths.</span></span><br><span class="line"><span class="comment"># Create your custom files in site directory `source/_data` and uncomment needed files below.</span></span><br><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="comment">#head: source/_data/head.njk</span></span><br><span class="line">  <span class="comment">#header: source/_data/header.njk</span></span><br><span class="line">  <span class="comment">#sidebar: source/_data/sidebar.njk</span></span><br><span class="line">  <span class="comment">#postMeta: source/_data/post-meta.njk</span></span><br><span class="line">  <span class="comment">#postBodyEnd: source/_data/post-body-end.njk</span></span><br><span class="line">  <span class="comment">#footer: source/_data/footer.njk</span></span><br><span class="line">  <span class="comment">#bodyEnd: source/_data/body-end.njk</span></span><br><span class="line">  <span class="comment">#variable: source/_data/variables.styl</span></span><br><span class="line">  <span class="comment">#mixin: source/_data/mixins.styl</span></span><br><span class="line">  <span class="comment">#style: source/_data/styles.styl</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Scheme Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Schemes</span></span><br><span class="line"><span class="comment">#scheme: Muse</span></span><br><span class="line"><span class="comment">#scheme: Mist</span></span><br><span class="line"><span class="comment">#scheme: Pisces</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Gemini</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dark Mode 开启夜晚模式</span></span><br><span class="line"><span class="attr">darkmode:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Site Information Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">favicon:</span></span><br><span class="line">  <span class="attr">small:</span> <span class="string">/images/favicon-16x16-next.png</span></span><br><span class="line">  <span class="attr">medium:</span> <span class="string">/images/favicon-32x32-next.png</span></span><br><span class="line">  <span class="attr">apple_touch_icon:</span> <span class="string">/images/apple-touch-icon-next.png</span></span><br><span class="line">  <span class="attr">safari_pinned_tab:</span> <span class="string">/images/logo.svg</span></span><br><span class="line">  <span class="comment">#android_manifest: /manifest.json</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom Logo (Warning: Do not support scheme Mist)</span></span><br><span class="line"><span class="attr">custom_logo:</span> <span class="comment">#/uploads/custom-logo.jpg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 版权提示, 原版是需要配置post_copyright的.新版本不需要</span></span><br><span class="line"><span class="comment"># Creative Commons 4.0 International License.</span></span><br><span class="line"><span class="comment"># See: https://creativecommons.org/about/cclicenses/</span></span><br><span class="line"><span class="attr">creative_commons:</span></span><br><span class="line">  <span class="comment"># Available values: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | cc-zero</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">by-nc-sa</span></span><br><span class="line">  <span class="comment"># Available values: big | small</span></span><br><span class="line">  <span class="attr">size:</span> <span class="string">small</span></span><br><span class="line">  <span class="attr">sidebar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">post:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># You can set a language value if you prefer a translated version of CC license, e.g. deed.zh</span></span><br><span class="line">  <span class="comment"># CC licenses are available in 39 languages, you can find the specific and correct abbreviation you need on https://creativecommons.org</span></span><br><span class="line">  <span class="attr">language:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Open graph settings</span></span><br><span class="line"><span class="comment"># See: https://hexo.io/docs/helpers#open-graph</span></span><br><span class="line"><span class="attr">open_graph:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">    <span class="comment">#twitter_card: &lt;twitter:card&gt;</span></span><br><span class="line">    <span class="comment">#twitter_id: &lt;twitter:creator&gt;</span></span><br><span class="line">    <span class="comment">#twitter_site: &lt;twitter:site&gt;</span></span><br><span class="line">    <span class="comment">#twitter_image: &lt;twitter:image&gt;</span></span><br><span class="line">    <span class="comment">#google_plus: &lt;g+:profile_link&gt;</span></span><br><span class="line">    <span class="comment">#fb_admins: &lt;fb:admin_id&gt;</span></span><br><span class="line">    <span class="comment">#fb_app_id: &lt;fb:app_id&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage: `Key: /link/ || icon`</span></span><br><span class="line"><span class="comment"># Key is the name of menu item. If the translation for this item is available, the translated text will be loaded, otherwise the Key name will be used. Key is case-sensitive.</span></span><br><span class="line"><span class="comment"># Value before `||` delimiter is the target link, value after `||` delimiter is the name of Font Awesome icon.</span></span><br><span class="line"><span class="comment"># External url should start with http:// or https://</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="comment">#about: /about/ || fa fa-user</span></span><br><span class="line">  <span class="comment">#tags: /tags/ || fa fa-tags</span></span><br><span class="line">  <span class="comment">#categories: /categories/ || fa fa-th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line">  <span class="comment">#commonweal: /404/ || fa fa-heartbeat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable / Disable menu icons / item badges.</span></span><br><span class="line"><span class="attr">menu_settings:</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">badges:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Sidebar Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/sidebar</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sidebar:</span></span><br><span class="line">  <span class="comment"># Sidebar Position.</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">left</span></span><br><span class="line">  <span class="comment">#position: right</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Manual define the sidebar width. If commented, will be default for:</span></span><br><span class="line">  <span class="comment"># Muse | Mist: 320</span></span><br><span class="line">  <span class="comment"># Pisces | Gemini: 240</span></span><br><span class="line">  <span class="comment">#width: 300</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Sidebar Display (only for Muse | Mist), available values:</span></span><br><span class="line">  <span class="comment">#  - post    expand on posts automatically. Default.</span></span><br><span class="line">  <span class="comment">#  - always  expand for all pages automatically.</span></span><br><span class="line">  <span class="comment">#  - hide    expand only when click on the sidebar toggle icon.</span></span><br><span class="line">  <span class="comment">#  - remove  totally remove sidebar including sidebar toggle.</span></span><br><span class="line">  <span class="attr">display:</span> <span class="string">post</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Sidebar padding in pixels.</span></span><br><span class="line">  <span class="attr">padding:</span> <span class="number">18</span></span><br><span class="line">  <span class="comment"># Sidebar offset from top menubar in pixels (only for Pisces | Gemini).</span></span><br><span class="line">  <span class="attr">offset:</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sidebar Avatar 个人头像</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="comment"># Replace the default image and set the url here.</span></span><br><span class="line">  <span class="attr">url:</span> <span class="comment">#/images/avatar.gif</span></span><br><span class="line">  <span class="comment"># If true, the avatar will be displayed in circle.</span></span><br><span class="line">  <span class="attr">rounded:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, the avatar will be rotated with the cursor.</span></span><br><span class="line">  <span class="attr">rotated:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Posts / Categories / Tags in sidebar.</span></span><br><span class="line"><span class="attr">site_state:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social Links</span></span><br><span class="line"><span class="comment"># Usage: `Key: permalink || icon`</span></span><br><span class="line"><span class="comment"># Key is the link label showing to end users.</span></span><br><span class="line"><span class="comment"># Value before `||` delimiter is the target permalink, value after `||` delimiter is the name of Font Awesome icon.</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">https://github.com/jev001</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">  <span class="comment">#E-Mail: mailto:yourname@gmail.com || fa fa-envelope</span></span><br><span class="line">  <span class="comment">#Weibo: https://weibo.com/yourname || fab fa-weibo</span></span><br><span class="line">  <span class="comment">#Google: https://plus.google.com/yourname || fab fa-google</span></span><br><span class="line">  <span class="comment">#Twitter: https://twitter.com/yourname || fab fa-twitter</span></span><br><span class="line">  <span class="comment">#FB Page: https://www.facebook.com/yourname || fab fa-facebook</span></span><br><span class="line">  <span class="comment">#StackOverflow: https://stackoverflow.com/yourname || fab fa-stack-overflow</span></span><br><span class="line">  <span class="comment">#YouTube: https://youtube.com/yourname || fab fa-youtube</span></span><br><span class="line">  <span class="comment">#Instagram: https://instagram.com/yourname || fab fa-instagram</span></span><br><span class="line">  <span class="comment">#Skype: skype:yourname?call|chat || fab fa-skype</span></span><br><span class="line"></span><br><span class="line"><span class="attr">social_icons:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">icons_only:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">transition:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Blog rolls</span></span><br><span class="line"><span class="attr">links_settings:</span></span><br><span class="line">  <span class="attr">icon:</span> <span class="string">fa</span> <span class="string">fa-globe</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Links</span></span><br><span class="line">  <span class="comment"># Available values: block | inline</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">block</span></span><br><span class="line"></span><br><span class="line"><span class="attr">links:</span></span><br><span class="line">  <span class="comment">#Title: https://example.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Table of Contents in the Sidebar</span></span><br><span class="line"><span class="comment"># Front-matter variable (nonsupport wrap expand_all).</span></span><br><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Automatically add list number to toc.</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, all words will placed on next lines if header width longer then sidebar width.</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, all level of TOC in a post will be displayed, rather than the activated part of it.</span></span><br><span class="line">  <span class="attr">expand_all:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Maximum heading depth of generated toc.</span></span><br><span class="line">  <span class="attr">max_depth:</span> <span class="number">6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Footer Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/footer</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show multilingual switcher in footer.</span></span><br><span class="line"><span class="attr">language_switcher:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="comment"># Specify the year when the site was setup. If not defined, current year will be used.</span></span><br><span class="line">  <span class="comment">#since: 2021</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Icon between year and copyright info.</span></span><br><span class="line">  <span class="attr">icon:</span></span><br><span class="line">    <span class="comment"># Icon name in Font Awesome. See: https://fontawesome.com/icons</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fa</span> <span class="string">fa-heart</span></span><br><span class="line">    <span class="comment"># If you want to animate the icon, set it to true.</span></span><br><span class="line">    <span class="attr">animated:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># Change the color of icon, using Hex Code.</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">&quot;#ff0000&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># If not defined, `author` from Hexo `_config.yml` will be used.</span></span><br><span class="line">  <span class="attr">copyright:</span> <span class="string">jev001.</span> <span class="string">All</span> <span class="string">rights</span> <span class="string">reserved.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Powered by Hexo &amp; NexT</span></span><br><span class="line">  <span class="attr">powered:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 备案信息 </span></span><br><span class="line">  <span class="comment"># Beian ICP and gongan information for Chinese users. See: https://beian.miit.gov.cn, http://www.beian.gov.cn</span></span><br><span class="line">  <span class="attr">beian:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">icp:</span></span><br><span class="line">    <span class="comment"># The digit in the num of gongan beian.</span></span><br><span class="line">    <span class="attr">gongan_id:</span></span><br><span class="line">    <span class="comment"># The full num of gongan beian.</span></span><br><span class="line">    <span class="attr">gongan_num:</span></span><br><span class="line">    <span class="comment"># The icon for gongan beian. See: http://www.beian.gov.cn/portal/download</span></span><br><span class="line">    <span class="attr">gongan_icon_url:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Post Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/posts</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically excerpt description in homepage as preamble text.</span></span><br><span class="line"><span class="attr">excerpt_description:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read more button</span></span><br><span class="line"><span class="comment"># If true, the read more button will be displayed in excerpt section.</span></span><br><span class="line"><span class="attr">read_more_btn:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Post meta display settings</span></span><br><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">item_text:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">created_at:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">updated_at:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">another_day:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Post wordcount display settings</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/next-theme/hexo-word-counter</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">item_text_total:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use icon instead of the symbol # to indicate the tag at the bottom of the post</span></span><br><span class="line"><span class="attr">tag_icon:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Donate (Sponsor) settings</span></span><br><span class="line"><span class="comment"># Front-matter variable (nonsupport animation).</span></span><br><span class="line"><span class="attr">reward_settings:</span></span><br><span class="line">  <span class="comment"># If true, a donate button will be displayed in every article by default.</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">animation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment">#comment: Buy me a coffee</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="comment">#wechatpay: /images/wechatpay.png</span></span><br><span class="line">  <span class="comment">#alipay: /images/alipay.png</span></span><br><span class="line">  <span class="comment">#paypal: /images/paypal.png</span></span><br><span class="line">  <span class="comment">#bitcoin: /images/bitcoin.png</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Subscribe through Telegram Channel, Twitter, etc.</span></span><br><span class="line"><span class="comment"># Usage: `Key: permalink || icon` (Font Awesome)</span></span><br><span class="line"><span class="attr">follow_me:</span></span><br><span class="line">  <span class="comment">#Twitter: https://twitter.com/username || fab fa-twitter</span></span><br><span class="line">  <span class="comment">#Telegram: https://t.me/channel_name || fab fa-telegram</span></span><br><span class="line">  <span class="comment">#WeChat: /images/wechat_channel.jpg || fab fa-weixin</span></span><br><span class="line">  <span class="comment">#RSS: /atom.xml || fa fa-rss</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Related popular posts</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/sergeyzwezdin/hexo-related-posts</span></span><br><span class="line"><span class="attr">related_posts:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">title:</span> <span class="comment"># Custom header, leave empty to use the default one</span></span><br><span class="line">  <span class="attr">display_in_home:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Post edit</span></span><br><span class="line"><span class="comment"># Easily browse and edit blog source code online.</span></span><br><span class="line"><span class="attr">post_edit:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/</span> <span class="comment"># Link for view source</span></span><br><span class="line">  <span class="comment">#url: https://github.com/user-name/repo-name/edit/branch-name/subdirectory-name/ # Link for fork &amp; edit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show previous post and next post in post footer if exists</span></span><br><span class="line"><span class="comment"># Available values: left | right | false</span></span><br><span class="line"><span class="attr">post_navigation:</span> <span class="string">left</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Custom Page Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/custom-pages</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TagCloud settings for tags page.</span></span><br><span class="line"><span class="attr">tagcloud:</span></span><br><span class="line">  <span class="attr">min:</span> <span class="number">12</span> <span class="comment"># Minimum font size in px</span></span><br><span class="line">  <span class="attr">max:</span> <span class="number">30</span> <span class="comment"># Maximum font size in px</span></span><br><span class="line">  <span class="attr">amount:</span> <span class="number">200</span> <span class="comment"># Total amount of tags</span></span><br><span class="line">  <span class="attr">orderby:</span> <span class="string">name</span> <span class="comment"># Order of tags</span></span><br><span class="line">  <span class="attr">order:</span> <span class="number">1</span> <span class="comment"># Sort order</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google Calendar</span></span><br><span class="line"><span class="comment"># Share your recent schedule to others via calendar page.</span></span><br><span class="line"><span class="attr">calendar:</span></span><br><span class="line">  <span class="attr">calendar_id:</span> <span class="string">&lt;required&gt;</span> <span class="comment"># Your Google account E-Mail</span></span><br><span class="line">  <span class="attr">api_key:</span> <span class="string">&lt;required&gt;</span></span><br><span class="line">  <span class="attr">orderBy:</span> <span class="string">startTime</span></span><br><span class="line">  <span class="attr">showLocation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">offsetMax:</span> <span class="number">72</span> <span class="comment"># Time Range</span></span><br><span class="line">  <span class="attr">offsetMin:</span> <span class="number">4</span> <span class="comment"># Time Range</span></span><br><span class="line">  <span class="attr">showDeleted:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">singleEvents:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">maxResults:</span> <span class="number">250</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Misc Theme Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/miscellaneous</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Preconnect CDN for fonts and plugins.</span></span><br><span class="line"><span class="comment"># For more information: https://www.w3.org/TR/resource-hints/#preconnect</span></span><br><span class="line"><span class="attr">preconnect:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the text alignment in posts / pages.</span></span><br><span class="line"><span class="attr">text_align:</span></span><br><span class="line">  <span class="comment"># Available values: start | end | left | right | center | justify | justify-all | match-parent</span></span><br><span class="line">  <span class="attr">desktop:</span> <span class="string">justify</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="string">justify</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reduce padding / margin indents on devices with narrow width.</span></span><br><span class="line"><span class="attr">mobile_layout_economy:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Browser header panel color.</span></span><br><span class="line"><span class="attr">theme_color:</span></span><br><span class="line">  <span class="attr">light:</span> <span class="string">&quot;#222&quot;</span></span><br><span class="line">  <span class="attr">dark:</span> <span class="string">&quot;#222&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Override browsers&#x27; default behavior.</span></span><br><span class="line"><span class="attr">body_scrollbar:</span></span><br><span class="line">  <span class="comment"># Place the scrollbar over the content.</span></span><br><span class="line">  <span class="attr">overlay:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Present the scrollbar even if the content is not overflowing.</span></span><br><span class="line">  <span class="attr">stable:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="comment"># Code Highlight theme</span></span><br><span class="line">  <span class="comment"># All available themes: https://theme-next.js.org/highlight/</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">stackoverflow-dark</span></span><br><span class="line">  <span class="attr">prism:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">prism</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">prism-dark</span></span><br><span class="line">  <span class="comment"># Add copy button on codeblock</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># Available values: default | flat | mac</span></span><br><span class="line">    <span class="attr">style:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回顶端</span></span><br><span class="line"><span class="attr">back2top:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Back to top in sidebar.</span></span><br><span class="line">  <span class="attr">sidebar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Scroll percent label in b2t button.</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阅读进度条</span></span><br><span class="line"><span class="comment"># Reading progress bar</span></span><br><span class="line"><span class="attr">reading_progress:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Available values: left | right</span></span><br><span class="line">  <span class="attr">start_at:</span> <span class="string">left</span></span><br><span class="line">  <span class="comment"># Available values: top | bottom</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">top</span></span><br><span class="line">  <span class="attr">reversed:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;#37c6c0&quot;</span></span><br><span class="line">  <span class="attr">height:</span> <span class="string">3px</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bookmark Support</span></span><br><span class="line"><span class="attr">bookmark:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Customize the color of the bookmark.</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;#222&quot;</span></span><br><span class="line">  <span class="comment"># If auto, save the reading progress when closing the page or clicking the bookmark-icon.</span></span><br><span class="line">  <span class="comment"># If manual, only save it by clicking the bookmark-icon.</span></span><br><span class="line">  <span class="attr">save:</span> <span class="string">auto</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 展示follow me on github的链接图标</span></span><br><span class="line"><span class="comment"># `Follow me on GitHub` banner in the top-right corner.</span></span><br><span class="line"><span class="attr">github_banner:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">permalink:</span> <span class="string">https://github.com/jev001</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Follow</span> <span class="string">me</span> <span class="string">on</span> <span class="string">GitHub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Font Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Find fonts on Google Fonts (https://fonts.google.com)</span></span><br><span class="line"><span class="comment"># All fonts set here will have the following styles:</span></span><br><span class="line"><span class="comment">#   light | light italic | normal | normal italic | bold | bold italic</span></span><br><span class="line"><span class="comment"># Be aware that setting too much fonts will cause site running slowly</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Web Safe fonts are recommended for `global` (and `title`):</span></span><br><span class="line"><span class="comment"># Arial | Tahoma | Helvetica | Times New Roman | Courier New | Verdana | Georgia | Palatino | Garamond | Comic Sans MS | Trebuchet MS</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Uri of fonts host, e.g. https://fonts.googleapis.com (Default).</span></span><br><span class="line">  <span class="attr">host:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font options:</span></span><br><span class="line">  <span class="comment"># `external: true` will load this font family from `host` above.</span></span><br><span class="line">  <span class="comment"># `family: Times New Roman`. Without any quotes.</span></span><br><span class="line">  <span class="comment"># `size: x.x`. Use `em` as unit. Default: 1 (16px)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Global font settings used for all elements inside &lt;body&gt;.</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Lato</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for site title (.site-title).</span></span><br><span class="line">  <span class="attr">title:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;).</span></span><br><span class="line">  <span class="attr">headings:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for posts (.post-body).</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class="line">  <span class="attr">codes:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># SEO Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/theme-settings/seo</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If true, site-subtitle will be added to index page.</span></span><br><span class="line"><span class="comment"># Remember to set up your site-subtitle in Hexo `_config.yml` (e.g. subtitle: Subtitle)</span></span><br><span class="line"><span class="attr">index_with_subtitle:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically add external URL with Base64 encrypt &amp; decrypt.</span></span><br><span class="line"><span class="attr">exturl:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># If true, an icon will be attached to each external URL</span></span><br><span class="line"><span class="attr">exturl_icon:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google Webmaster tools verification.</span></span><br><span class="line"><span class="comment"># See: https://developers.google.com/search</span></span><br><span class="line"><span class="attr">google_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bing Webmaster tools verification.</span></span><br><span class="line"><span class="comment"># See: https://www.bing.com/webmasters</span></span><br><span class="line"><span class="attr">bing_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Yandex Webmaster tools verification.</span></span><br><span class="line"><span class="comment"># See: https://webmaster.yandex.ru</span></span><br><span class="line"><span class="attr">yandex_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Baidu Webmaster tools verification.</span></span><br><span class="line"><span class="comment"># See: https://ziyuan.baidu.com/site</span></span><br><span class="line"><span class="attr">baidu_site_verification:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Third Party Plugins &amp; Services Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/</span></span><br><span class="line"><span class="comment"># More plugins: https://github.com/next-theme/awesome-next</span></span><br><span class="line"><span class="comment"># You may need to install the corresponding dependency packages</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否开启数学符号解析---- 之后开启吧. 目前不用latex</span></span><br><span class="line"><span class="comment"># Math Formulas Render Support</span></span><br><span class="line"><span class="comment"># Warning: Please install / uninstall the relevant renderer according to the documentation.</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/math-equations</span></span><br><span class="line"><span class="comment"># Server-side plugin: https://github.com/next-theme/hexo-filter-mathjax</span></span><br><span class="line"><span class="attr">math:</span></span><br><span class="line">  <span class="comment"># Default (false) will load mathjax / katex script on demand.</span></span><br><span class="line">  <span class="comment"># That is it only render those page which has `mathjax: true` in front-matter.</span></span><br><span class="line">  <span class="comment"># If you set it to true, it will load mathjax / katex script EVERY PAGE.</span></span><br><span class="line">  <span class="attr">every_page:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mathjax:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># Available values: none | ams | all</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="string">none</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">katex:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># See: https://github.com/KaTeX/KaTeX/tree/master/contrib/copy-tex</span></span><br><span class="line">    <span class="attr">copy_tex:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Easily enable fast Ajax navigation on your website.</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/next-theme/pjax</span></span><br><span class="line"><span class="attr">pjax:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FancyBox is a tool that offers a nice and elegant way to add zooming functionality for images.</span></span><br><span class="line"><span class="comment"># For more information: https://fancyapps.com/fancybox/</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A JavaScript library for zooming images like Medium.</span></span><br><span class="line"><span class="comment"># Warning: Do not enable both `fancybox` and `mediumzoom`.</span></span><br><span class="line"><span class="comment"># For more information: https://medium-zoom.francoischalifour.com</span></span><br><span class="line"><span class="attr">mediumzoom:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Vanilla JavaScript plugin for lazyloading images.</span></span><br><span class="line"><span class="comment"># For more information: https://apoorv.pro/lozad.js/demo/</span></span><br><span class="line"><span class="attr">lazyload:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pangu Support</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/vinta/pangu.js</span></span><br><span class="line"><span class="comment"># Server-side plugin: https://github.com/next-theme/hexo-pangu</span></span><br><span class="line"><span class="attr">pangu:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Quicklink Support</span></span><br><span class="line"><span class="comment"># For more information: https://getquick.link</span></span><br><span class="line"><span class="comment"># Front-matter variable (nonsupport home archive).</span></span><br><span class="line"><span class="attr">quicklink:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Home page and archive page can be controlled through home and archive options below.</span></span><br><span class="line">  <span class="comment"># This configuration item is independent of `enable`.</span></span><br><span class="line">  <span class="attr">home:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">archive:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Default (true) will initialize quicklink after the load event fires.</span></span><br><span class="line">  <span class="attr">delay:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Custom a time in milliseconds by which the browser must execute prefetching.</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">3000</span></span><br><span class="line">  <span class="comment"># Default (true) will attempt to use the fetch() API if supported (rather than link[rel=prefetch]).</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Comments Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/comments</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 评论 待开启</span></span><br><span class="line"><span class="comment"># Multiple Comment System Support</span></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="comment"># Available values: tabs | buttons</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">tabs</span></span><br><span class="line">  <span class="comment"># Choose a comment system to be displayed by default.</span></span><br><span class="line">  <span class="comment"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances</span></span><br><span class="line">  <span class="attr">active:</span></span><br><span class="line">  <span class="comment"># Setting `true` means remembering the comment system selected by the visitor.</span></span><br><span class="line">  <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Lazyload all comment systems.</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Modify texts or order for any naves, here are some examples.</span></span><br><span class="line">  <span class="attr">nav:</span></span><br><span class="line">    <span class="comment">#disqus:</span></span><br><span class="line">    <span class="comment">#  text: Load Disqus</span></span><br><span class="line">    <span class="comment">#  order: -1</span></span><br><span class="line">    <span class="comment">#gitalk:</span></span><br><span class="line">    <span class="comment">#  order: -2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disqus</span></span><br><span class="line"><span class="comment"># For more information: https://disqus.com</span></span><br><span class="line"><span class="attr">disqus:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">shortname:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DisqusJS</span></span><br><span class="line"><span class="comment"># For more information: https://disqusjs.skk.moe</span></span><br><span class="line"><span class="attr">disqusjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># API Endpoint of Disqus API (https://disqus.com/api/docs/).</span></span><br><span class="line">  <span class="comment"># Leave api empty if you are able to connect to Disqus API. Otherwise you need a reverse proxy for it.</span></span><br><span class="line">  <span class="comment"># For example:</span></span><br><span class="line">  <span class="comment"># api: https://disqus.skk.moe/disqus/</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">  <span class="attr">apikey:</span> <span class="comment"># Register new application from https://disqus.com/api/applications/</span></span><br><span class="line">  <span class="attr">shortname:</span> <span class="comment"># See: https://disqus.com/admin/settings/general/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Changyan</span></span><br><span class="line"><span class="comment"># For more information: https://changyan.kuaizhan.com</span></span><br><span class="line"><span class="attr">changyan:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">appid:</span></span><br><span class="line">  <span class="attr">appkey:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LiveRe comments system</span></span><br><span class="line"><span class="comment"># You can get your uid from https://livere.com/insight/myCode (General web site)</span></span><br><span class="line"><span class="attr">livere_uid:</span> <span class="comment"># &lt;your_uid&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Gitalk</span></span><br><span class="line"><span class="comment"># For more information: https://gitalk.github.io</span></span><br><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">github_id:</span> <span class="comment"># GitHub repo owner</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="comment"># Repository name to store issues</span></span><br><span class="line">  <span class="attr">client_id:</span> <span class="comment"># GitHub Application Client ID</span></span><br><span class="line">  <span class="attr">client_secret:</span> <span class="comment"># GitHub Application Client Secret</span></span><br><span class="line">  <span class="attr">admin_user:</span> <span class="comment"># GitHub repo owner and collaborators, only these guys can initialize gitHub issues</span></span><br><span class="line">  <span class="attr">distraction_free_mode:</span> <span class="literal">true</span> <span class="comment"># Facebook-like distraction free mode</span></span><br><span class="line">  <span class="comment"># When the official proxy is not available, you can change it to your own proxy address</span></span><br><span class="line">  <span class="attr">proxy:</span> <span class="string">https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</span> <span class="comment"># This is official proxy address</span></span><br><span class="line">  <span class="comment"># Gitalk&#x27;s display language depends on user&#x27;s browser or system environment</span></span><br><span class="line">  <span class="comment"># If you want everyone visiting your site to see a uniform language, you can set a force language value</span></span><br><span class="line">  <span class="comment"># Available values: en | es-ES | fr | ru | zh-CN | zh-TW</span></span><br><span class="line">  <span class="attr">language:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Utterances</span></span><br><span class="line"><span class="comment"># For more information: https://utteranc.es</span></span><br><span class="line"><span class="attr">utterances:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">user-name/repo-name</span> <span class="comment"># Github repository owner and name</span></span><br><span class="line">  <span class="comment"># Available values: pathname | url | title | og:title</span></span><br><span class="line">  <span class="attr">issue_term:</span> <span class="string">pathname</span></span><br><span class="line">  <span class="comment"># Available values: github-light | github-dark | preferred-color-scheme | github-dark-orange | icy-dark | dark-blue | photon-dark | boxy-light</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">github-light</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Isso</span></span><br><span class="line"><span class="comment"># For more information: https://posativ.org/isso/</span></span><br><span class="line"><span class="attr">isso:</span> <span class="comment"># &lt;data_isso&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Post Widgets &amp; Content Sharing Services</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/post-widgets</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Star rating support to each article.</span></span><br><span class="line"><span class="comment"># To get your ID visit https://widgetpack.com</span></span><br><span class="line"><span class="attr">rating:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">id:</span>     <span class="comment"># &lt;app_id&gt;</span></span><br><span class="line">  <span class="attr">color:</span>  <span class="string">&quot;#fc6423&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AddThis Share. See: https://www.addthis.com</span></span><br><span class="line"><span class="comment"># Go to https://www.addthis.com/dashboard to customize your tools.</span></span><br><span class="line"><span class="attr">add_this_id:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Statistics and Analytics</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/statistics-and-analytics</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google Analytics</span></span><br><span class="line"><span class="comment"># See: https://analytics.google.com</span></span><br><span class="line"><span class="attr">google_analytics:</span></span><br><span class="line">  <span class="attr">tracking_id:</span> <span class="comment"># &lt;app_id&gt;</span></span><br><span class="line">  <span class="comment"># By default, NexT will load an external gtag.js script on your site.</span></span><br><span class="line">  <span class="comment"># If you only need the pageview feature, set the following option to true to get a better performance.</span></span><br><span class="line">  <span class="attr">only_pageview:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Baidu Analytics</span></span><br><span class="line"><span class="comment"># See: https://tongji.baidu.com</span></span><br><span class="line"><span class="attr">baidu_analytics:</span> <span class="comment"># &lt;app_id&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Growingio Analytics</span></span><br><span class="line"><span class="comment"># See: https://www.growingio.com</span></span><br><span class="line"><span class="attr">growingio_analytics:</span> <span class="comment"># &lt;project_id&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cloudflare Web Analytics</span></span><br><span class="line"><span class="comment"># See: https://www.cloudflare.com/web-analytics/</span></span><br><span class="line"><span class="attr">cloudflare_analytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Microsoft Clarity Analytics</span></span><br><span class="line"><span class="comment"># See: https://clarity.microsoft.com/</span></span><br><span class="line"><span class="attr">clarity_analytics:</span> <span class="comment"># &lt;project_id&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show number of visitors of each article.</span></span><br><span class="line"><span class="comment"># You can visit https://www.leancloud.cn to get AppID and AppKey.</span></span><br><span class="line"><span class="attr">leancloud_visitors:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">app_id:</span> <span class="comment"># &lt;your app id&gt;</span></span><br><span class="line">  <span class="attr">app_key:</span> <span class="comment"># &lt;your app key&gt;</span></span><br><span class="line">  <span class="comment"># Required for apps from CN region</span></span><br><span class="line">  <span class="attr">server_url:</span> <span class="comment"># &lt;your server url&gt;</span></span><br><span class="line">  <span class="comment"># Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security</span></span><br><span class="line">  <span class="comment"># If you don&#x27;t care about security in leancloud counter and just want to use it directly</span></span><br><span class="line">  <span class="comment"># (without hexo-leancloud-counter-security plugin), set `security` to `false`.</span></span><br><span class="line">  <span class="attr">security:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Another tool to show number of visitors to each article.</span></span><br><span class="line"><span class="comment"># Visit https://console.firebase.google.com/u/0/ to get apiKey and projectId.</span></span><br><span class="line"><span class="comment"># Visit https://firebase.google.com/docs/firestore/ to get more information about firestore.</span></span><br><span class="line"><span class="attr">firestore:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">collection:</span> <span class="string">articles</span> <span class="comment"># Required, a string collection name to access firestore database</span></span><br><span class="line">  <span class="attr">apiKey:</span> <span class="comment"># Required</span></span><br><span class="line">  <span class="attr">projectId:</span> <span class="comment"># Required</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show Views / Visitors of the website / page with busuanzi.</span></span><br><span class="line"><span class="comment"># For more information: http://ibruce.info/2015/04/04/busuanzi/</span></span><br><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">total_visitors:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_visitors_icon:</span> <span class="string">fa</span> <span class="string">fa-user</span></span><br><span class="line">  <span class="attr">total_views:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_views_icon:</span> <span class="string">fa</span> <span class="string">fa-eye</span></span><br><span class="line">  <span class="attr">post_views:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_views_icon:</span> <span class="string">far</span> <span class="string">fa-eye</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Search Services</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/search-services</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Algolia Search</span></span><br><span class="line"><span class="comment"># For more information: https://www.algolia.com</span></span><br><span class="line"><span class="attr">algolia_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">hits:</span></span><br><span class="line">    <span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Local Search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/next-theme/hexo-generator-searchdb</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If auto, trigger search by changing input.</span></span><br><span class="line">  <span class="comment"># If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># Unescape html strings to the readable one.</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Preload the search data when the page loads.</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Chat Services</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/third-party-services/chat-services</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A button to open designated chat widget in sidebar.</span></span><br><span class="line"><span class="comment"># Firstly, you need to enable and configure the chat service.</span></span><br><span class="line"><span class="attr">chat:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">icon:</span> <span class="string">fa</span> <span class="string">fa-comment</span> <span class="comment"># Icon name in Font Awesome, set false to disable icon.</span></span><br><span class="line">  <span class="attr">text:</span> <span class="string">Chat</span> <span class="comment"># Button text, change it as you wish.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Chatra Support</span></span><br><span class="line"><span class="comment"># For more information: https://chatra.com</span></span><br><span class="line"><span class="comment"># Dashboard: https://app.chatra.io/settings/general</span></span><br><span class="line"><span class="attr">chatra:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">async:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">id:</span> <span class="comment"># Visit Dashboard to get your ChatraID</span></span><br><span class="line">  <span class="comment">#embed: # Unfinished experimental feature for developers. See: https://chatra.com/help/api/#injectto</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tidio Support</span></span><br><span class="line"><span class="comment"># For more information: https://www.tidio.com</span></span><br><span class="line"><span class="comment"># Dashboard: https://www.tidio.com/panel/dashboard</span></span><br><span class="line"><span class="attr">tidio:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">key:</span> <span class="comment"># Public Key, get it from dashboard. See: https://www.tidio.com/panel/settings/developer</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Gitter Support</span></span><br><span class="line"><span class="comment"># For more information: https://gitter.im</span></span><br><span class="line"><span class="attr">gitter:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">room:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Tags Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/tag-plugins/</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Note tag (bootstrap callout)</span></span><br><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bootstrap callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bootstrap callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">simple</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tabs tag</span></span><br><span class="line"><span class="attr">tabs:</span></span><br><span class="line">  <span class="comment"># Make the nav bar of tabs with long content stick to the top.</span></span><br><span class="line">  <span class="attr">sticky:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">transition:</span></span><br><span class="line">    <span class="attr">tabs:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">labels:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PDF tag</span></span><br><span class="line"><span class="comment"># NexT will try to load pdf files natively, if failed, pdf.js will be used.</span></span><br><span class="line"><span class="comment"># So, you have to install the dependency of pdf.js if you want to use pdf tag and make it available to all browsers.</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/next-theme/theme-next-pdf</span></span><br><span class="line"><span class="attr">pdf:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Default height</span></span><br><span class="line">  <span class="attr">height:</span> <span class="string">500px</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mermaid tag</span></span><br><span class="line"><span class="attr">mermaid:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Available themes: default | dark | forest | neutral</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">dark</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Animation Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use Animate.css to animate everything.</span></span><br><span class="line"><span class="comment"># For more information: https://animate.style</span></span><br><span class="line"><span class="attr">motion:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">async:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">transition:</span></span><br><span class="line">    <span class="comment"># All available transition variants: https://theme-next.js.org/animate/</span></span><br><span class="line">    <span class="attr">post_block:</span> <span class="string">fadeIn</span></span><br><span class="line">    <span class="attr">post_header:</span> <span class="string">fadeInDown</span></span><br><span class="line">    <span class="attr">post_body:</span> <span class="string">fadeInDown</span></span><br><span class="line">    <span class="attr">coll_header:</span> <span class="string">fadeInLeft</span></span><br><span class="line">    <span class="comment"># Only for Pisces | Gemini.</span></span><br><span class="line">    <span class="attr">sidebar:</span> <span class="string">fadeInUp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Progress bar in the top during page loading.</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/CodeByZach/pace</span></span><br><span class="line"><span class="attr">pace:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># All available colors:</span></span><br><span class="line">  <span class="comment"># black | blue | green | orange | pink | purple | red | silver | white | yellow</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">blue</span></span><br><span class="line">  <span class="comment"># All available themes:</span></span><br><span class="line">  <span class="comment"># big-counter | bounce | barber-shop | center-atom | center-circle | center-radar | center-simple</span></span><br><span class="line">  <span class="comment"># corner-indicator | fill-left | flat-top | flash | loading-bar | mac-osx | material | minimal</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">minimal</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Canvas ribbon</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/hustcc/ribbon.js</span></span><br><span class="line"><span class="attr">canvas_ribbon:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">300</span> <span class="comment"># The width of the ribbon</span></span><br><span class="line">  <span class="attr">alpha:</span> <span class="number">0.6</span> <span class="comment"># The transparency of the ribbon</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span> <span class="comment"># The display level of the ribbon</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CDN Settings</span></span><br><span class="line"><span class="comment"># See: https://theme-next.js.org/docs/advanced-settings/vendors</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="comment"># The CDN provider of NexT internal scripts.</span></span><br><span class="line">  <span class="comment"># Available values: local | jsdelivr | unpkg | cdnjs | custom</span></span><br><span class="line">  <span class="comment"># Warning: If you are using the latest master branch of NexT, please set `internal: local`</span></span><br><span class="line">  <span class="attr">internal:</span> <span class="string">local</span></span><br><span class="line">  <span class="comment"># The default CDN provider of third-party plugins.</span></span><br><span class="line">  <span class="comment"># Available values: local | jsdelivr | unpkg | cdnjs | custom</span></span><br><span class="line">  <span class="comment"># Dependencies for `plugins: local`: https://github.com/next-theme/plugins</span></span><br><span class="line">  <span class="attr">plugins:</span> <span class="string">jsdelivr</span></span><br><span class="line">  <span class="comment"># Custom CDN URL</span></span><br><span class="line">  <span class="comment"># For example:</span></span><br><span class="line">  <span class="comment"># custom_cdn_url: https://cdn.jsdelivr.net/npm/$&#123;npm_name&#125;@$&#123;version&#125;/$&#123;minified&#125;</span></span><br><span class="line">  <span class="comment"># custom_cdn_url: https://cdnjs.cloudflare.com/ajax/libs/$&#123;cdnjs_name&#125;/$&#123;version&#125;/$&#123;cdnjs_file&#125;</span></span><br><span class="line">  <span class="attr">custom_cdn_url:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Assets</span></span><br><span class="line"><span class="comment"># Accelerate delivery of static files using a CDN</span></span><br><span class="line"><span class="comment"># The js option is only valid when vendors.internal is local.</span></span><br><span class="line"><span class="attr">css:</span> <span class="string">css</span></span><br><span class="line"><span class="attr">js:</span> <span class="string">js</span></span><br><span class="line"><span class="attr">images:</span> <span class="string">images</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##自定义看板娘动画</span></span><br><span class="line"><span class="attr">live2d:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span> <span class="comment">##主目录</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2d_models/</span> <span class="comment">##模型目录</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-koharu</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">left</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">80</span> <span class="comment">##宽度</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">120</span> <span class="comment">##高度</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span> <span class="comment">##移动端是否显示</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacity:</span> <span class="number">0.7</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
</search>
